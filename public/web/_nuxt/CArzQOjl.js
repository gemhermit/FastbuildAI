import{u as Ze,J as Ie,K as Xe,L as et,d as ue,g as Y,c as y,q as e,t as B,l as M,v as w,k as me,_ as Ve,o as m,x as Z,f as I,w as se,G as tt,j as ge,T as ot,y as xe,F as J,B as K,z as Q,n as de,i as Te,D as R,cT as De,a as Fe,cU as pe,cF as ie,bI as _e,p as D,cV as Ae,A as Ne}from"#entry";import st from"./--UdezPG.js";import{_ as nt}from"./CBooyAK7.js";import{s as lt}from"./BzLCLO6P.js";import{b as rt}from"./B1XcE43x.js";function at(i={}){return Ze("/user-schedule",i)}function it(i){return Ie("/user-schedule",i)}function Ee(i,_){return Xe(`/user-schedule/${i}`,_)}function dt(i){return et(`/user-schedule/${i}`)}function Pe(i){return Ie("/user-schedule/parse",i)}function ut(i){return Ie("/user-schedule/execute",i)}const ct={class:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm"},gt={class:"mb-3 flex items-start justify-between"},mt={class:"text-xs tracking-wide text-gray-500 uppercase"},pt={class:"text-base font-semibold text-gray-900"},ft={class:"space-y-2 text-sm text-gray-600"},vt={class:"grid grid-cols-3 gap-2"},yt={class:"col-span-2 font-medium"},bt={class:"grid grid-cols-3 gap-2"},xt={class:"col-span-2 font-medium"},ht={key:0,class:"grid grid-cols-3 gap-2"},wt={class:"col-span-2 font-medium"},Dt={key:1,class:"grid grid-cols-3 gap-2"},$t={class:"col-span-2 font-medium"},kt={class:"grid grid-cols-3 gap-2"},It={class:"col-span-2"},Tt={class:"rounded-md bg-gray-100 px-2 py-0.5 text-xs uppercase"},Ut={key:0,class:"mt-3 rounded-md bg-amber-50 p-3 text-xs text-amber-800"},St={key:0},Ct={class:"mt-4 flex items-center gap-2 text-sm"},Be=ue({__name:"ScheduleCard",props:{proposal:{},pending:{type:Boolean}},emits:["confirm","edit","cancel"],setup(i,{emit:_}){const a=i,c=Y(()=>(a.proposal.missingFields??[]).length>0),U=_,b=$=>{if(!$)return"-";const d=new Date($);return Number.isNaN(d.getTime())?$:new Intl.DateTimeFormat("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(d)},p=$=>$==="delete"?"error":$==="update"?"warning":$==="query"?"info":"primary";return($,d)=>{const S=nt,E=Ve;return m(),y("div",ct,[e("div",gt,[e("div",null,[e("p",mt,w(i.proposal.intent==="create"?"åˆ›å»ºææ¡ˆ":"æ—¥ç¨‹ææ¡ˆ"),1),e("p",pt,w(i.proposal.data.title||i.proposal.summary),1)]),M(S,{color:p(i.proposal.intent),size:"xs"},{default:me(()=>[Z(w(i.proposal.intent),1)]),_:1},8,["color"])]),e("dl",ft,[e("div",vt,[d[3]||(d[3]=e("dt",{class:"col-span-1 text-gray-500"},"å¼€å§‹æ—¶é—´",-1)),e("dd",yt,w(b(i.proposal.data.startTime)),1)]),e("div",bt,[d[4]||(d[4]=e("dt",{class:"col-span-1 text-gray-500"},"ç»“æŸæ—¶é—´",-1)),e("dd",xt,w(b(i.proposal.data.endTime)),1)]),i.proposal.data.location?(m(),y("div",ht,[d[5]||(d[5]=e("dt",{class:"col-span-1 text-gray-500"},"åœ°ç‚¹",-1)),e("dd",wt,w(i.proposal.data.location),1)])):B("",!0),i.proposal.data.attendees?(m(),y("div",Dt,[d[6]||(d[6]=e("dt",{class:"col-span-1 text-gray-500"},"å‚ä¸è€…",-1)),e("dd",$t,w(i.proposal.data.attendees),1)])):B("",!0),e("div",kt,[d[7]||(d[7]=e("dt",{class:"col-span-1 text-gray-500"},"ä¼˜å…ˆçº§",-1)),e("dd",It,[e("span",Tt,w(i.proposal.data.priority||"medium"),1)])])]),i.proposal.followUpQuestion||(i.proposal.missingFields?.length??0)>0?(m(),y("div",Ut,[e("div",null,w(i.proposal.followUpQuestion),1),i.proposal.missingFields?.length?(m(),y("div",St," ä»ç¼ºå°‘ï¼š"+w(i.proposal.missingFields.join("ï¼Œ")),1)):B("",!0)])):B("",!0),e("div",Ct,[M(E,{size:"xs",color:"primary",loading:i.pending,disabled:i.pending||c.value,onClick:d[0]||(d[0]=V=>U("confirm"))},{default:me(()=>[...d[8]||(d[8]=[Z(" ç¡®è®¤ ",-1)])]),_:1},8,["loading","disabled"]),M(E,{size:"xs",variant:"soft",color:"neutral",onClick:d[1]||(d[1]=V=>U("edit"))},{default:me(()=>[...d[9]||(d[9]=[Z("ç¼–è¾‘",-1)])]),_:1}),M(E,{size:"xs",variant:"ghost",color:"neutral",onClick:d[2]||(d[2]=V=>U("cancel"))},{default:me(()=>[...d[10]||(d[10]=[Z(" å–æ¶ˆ ",-1)])]),_:1})])])}}}),_t={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},At={class:"flex h-full w-full max-w-2xl flex-col overflow-hidden rounded-xl bg-white"},Nt={class:"flex items-center justify-between border-b px-5 py-3"},Et={class:"flex items-center gap-2"},Mt={key:1,class:"rounded-md bg-red-50 px-3 py-2 text-sm text-red-700"},Ot={class:"border-t bg-white p-4"},zt={class:"mt-2 text-xs text-gray-400"},Vt=ue({__name:"AIChatWidget",props:{open:{type:Boolean},modelId:{},timezone:{}},emits:["update:open","event-created","event-updated","event-deleted","query-result","edit-proposal"],setup(i,{emit:_}){const a=i,c=_,U=I([{id:crypto.randomUUID(),role:"assistant",content:"æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„ AI æ—¥ç¨‹åŠ©æ‰‹ã€‚å‘Šè¯‰æˆ‘æ‚¨æƒ³å®‰æ’æˆ–æŸ¥è¯¢çš„äº‹æƒ…å§ï½",timestamp:Date.now()}]),b=I(""),p=I(!1),$=I(!1),d=I(null),S=I(null),E=I(null);se(()=>a.open,async u=>{u?(await tt(),z()):(b.value="",d.value=null)}),se(U,()=>z(),{deep:!0});const V=Y(()=>a.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),z=()=>{const u=E.value;u&&requestAnimationFrame(()=>{const r=E.value??u;r.scrollTop=r.scrollHeight})},q=async()=>{const u=b.value.trim();if(!(!u||p.value)){S.value=null,W("user",u),b.value="",p.value=!0;try{const r=await Pe({message:u,timezone:V.value,modelId:a.modelId});g(r)}catch(r){console.error("AI schedule parse failed",r),W("assistant","æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å“åº”ï¼Œè¯·ç¨åé‡è¯•ã€‚")}finally{p.value=!1}}},g=u=>{H(u.reply),d.value=u.proposal??null,u.requiresClarification&&u.followUpQuestion&&W("assistant",u.followUpQuestion)},f=async()=>{if(!d.value||$.value)return;const u=d.value,r={intent:u.intent,scheduleId:u.originalEventId,data:u.data,summary:u.summary};$.value=!0,S.value=null;try{const k=await ut(r);j(k.intent,k.event,k.events),H(k.message),d.value=null}catch(k){S.value="æ‰§è¡Œå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚",console.error("Execute schedule failed",k)}finally{$.value=!1}},j=(u,r,k)=>{u==="create"&&r?c("event-created",r):u==="update"&&r?c("event-updated",r):u==="delete"&&r?c("event-deleted",r.id):u==="query"&&k&&c("query-result",k)},F=()=>{d.value=null},N=()=>{d.value&&(c("edit-proposal",d.value),d.value=null)},W=(u,r)=>{U.value.push({id:crypto.randomUUID(),role:u,content:r,timestamp:Date.now()})},H=u=>{if(!u){W("assistant","");return}const r={id:crypto.randomUUID(),role:"assistant",content:"",timestamp:Date.now()};U.value.push(r);let k=0;const n=lt(()=>{r.content+=u[k]??"",k+=1,k>=u.length&&clearInterval(n)},25)};return(u,r)=>{const k=xe,n=Ve,t=st;return m(),ge(ot,{name:"fade"},{default:me(()=>[i.open?(m(),y("div",_t,[e("div",At,[e("header",Nt,[e("div",Et,[M(k,{name:"i-lucide-bot",class:"text-blue-600"}),r[2]||(r[2]=e("div",null,[e("p",{class:"text-sm font-semibold"},"AI æ—¥ç¨‹åŠ©æ‰‹"),e("p",{class:"text-xs text-gray-500"},"è‡ªåŠ¨è¯†åˆ«æ„å›¾ä¸æ‹Ÿå®šæ—¥ç¨‹")],-1))]),M(n,{icon:"i-lucide-x",size:"xs",color:"neutral",variant:"ghost",onClick:r[0]||(r[0]=l=>c("update:open",!1))})]),e("div",{ref_key:"containerRef",ref:E,class:"flex-1 space-y-4 overflow-y-auto bg-gray-50 px-4 py-5"},[(m(!0),y(J,null,K(U.value,l=>(m(),y("div",{key:l.id,class:Q(["flex",l.role==="user"?"justify-end":"justify-start"])},[e("div",{class:Q(["max-w-[80%] rounded-2xl px-3 py-2 text-sm",l.role==="user"?"rounded-br-none bg-blue-600 text-white":"rounded-bl-none bg-white text-gray-800 shadow"])},w(l.content),3)],2))),128)),d.value?(m(),ge(Be,{key:0,proposal:d.value,pending:$.value,onConfirm:f,onCancel:F,onEdit:N},null,8,["proposal","pending"])):B("",!0),S.value?(m(),y("div",Mt,w(S.value),1)):B("",!0)],512),e("footer",Ot,[e("form",{class:"flex gap-3",onSubmit:de(q,["prevent"])},[M(t,{modelValue:b.value,"onUpdate:modelValue":r[1]||(r[1]=l=>b.value=l),placeholder:"ä¾‹å¦‚ï¼šæ˜å¤©ä¸‹åˆ3ç‚¹å’Œå°ç‹å¼€ä¸ªä¼š",disabled:p.value,class:"flex-1"},null,8,["modelValue","disabled"]),M(n,{type:"submit",color:"primary",loading:p.value,disabled:!b.value.trim()},{default:me(()=>[...r[3]||(r[3]=[Z(" å‘é€ ",-1)])]),_:1},8,["loading","disabled"])],32),e("p",zt,"æ—¶åŒºï¼š"+w(V.value),1)])])])):B("",!0)]),_:1})}}}),ye=(i=0,_=0)=>{const a=new Date;a.setMonth(a.getMonth()+i),a.setDate(a.getDate()+_);const c=a.getFullYear(),U=String(a.getMonth()+1).padStart(2,"0"),b=String(a.getDate()).padStart(2,"0");return`${c}-${U}-${b}`},oe=i=>{const _=i.getFullYear(),a=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${_}-${a}-${c}`},be=i=>{const[_,a,c]=i.split("-");return new Date(Number(_),Number(a)-1,Number(c))},Ft={work:"ğŸ’¼",personal:"ğŸ‘¤",meeting:"ğŸ¤",reminder:"â°",uncategorized:"ğŸ“"},Pt={class:"group relative rounded-lg border border-dashed border-gray-200 px-4 py-6 text-center text-sm text-gray-400 transition hover:border-blue-200 hover:bg-blue-50/40"},Bt={class:"pointer-events-none absolute inset-0 flex items-center justify-center gap-4 opacity-0 transition group-hover:opacity-100"},jt=ue({__name:"empty-hover-actions",props:{message:{},createLabel:{},aiLabel:{}},emits:["create","openAi"],setup(i,{emit:_}){const a=i,c=_;return(U,b)=>(m(),y("div",Pt,[Z(w(a.message||"è¿˜æ²¡æœ‰æ—¥ç¨‹")+" ",1),e("div",Bt,[e("button",{class:"pointer-events-auto rounded-full bg-blue-600 px-4 py-2 text-xs font-semibold text-white shadow hover:bg-blue-700",onClick:b[0]||(b[0]=de(p=>c("create"),["stop"]))},w(a.createLabel||"æ–°å»ºæ—¥ç¨‹"),1),e("button",{class:"pointer-events-auto rounded-full bg-purple-600 px-4 py-2 text-xs font-semibold text-white shadow hover:bg-purple-700",onClick:b[1]||(b[1]=de(p=>c("openAi"),["stop"]))},w(a.aiLabel||"AIå†™å¾…åŠ"),1)])]))}}),Lt={key:0,class:"mb-4 flex flex-wrap items-center gap-3"},Rt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},Wt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},qt={class:"inline-flex items-center gap-2 text-sm text-gray-700"},Gt={key:0},Qt={key:1,class:"space-y-4"},Ht={class:"flex items-center gap-2 text-sm font-semibold text-gray-800"},Yt={class:"space-y-1.5"},Jt=["onDblclick"],Kt=["onClick","title"],Zt={class:"flex min-w-0 flex-1 flex-col"},Xt={class:"relative min-h-[32px]"},eo=["id","onKeydown","onBlur"],to={class:"mt-0.5 text-xs text-gray-500"},oo={class:"flex items-center gap-2 text-xs text-gray-500"},so={key:0,class:"rounded-full border border-red-200 px-2 py-0.5 text-red-600"},no={key:1,class:"rounded-full border border-orange-200 px-2 py-0.5 text-orange-600"},lo=["onClick"],ro=["onClick","disabled"],Me="schedule:list-view-prefs",Ue=ue({__name:"list-view",props:{selectedDate:{},scheduleItems:{},deletingId:{},variant:{},sortBy:{},showCompleted:{type:Boolean,default:void 0}},emits:["toggleComplete","toggleImportant","toggleUrgent","edit","delete","create","openAi","updateTitle"],setup(i,{emit:_}){const a=i,c=_,U=I(a.sortBy??"time"),b=I("asc"),p=I("all"),$=I(!0),d=I(!1),S=I(!1),E=()=>{if(!(typeof window>"u"))try{const t=window.localStorage.getItem(Me);if(!t)return;const l=JSON.parse(t);l.sortBy&&(U.value=l.sortBy),l.sortOrder&&(b.value=l.sortOrder),l.filter&&(p.value=l.filter),typeof l.showCompleted=="boolean"&&($.value=l.showCompleted),typeof l.importantOnly=="boolean"&&(d.value=l.importantOnly),typeof l.urgentOnly=="boolean"&&(S.value=l.urgentOnly)}catch(t){console.warn("Failed to restore list prefs",t)}},V=()=>{if(typeof window>"u")return;const t={sortBy:U.value,sortOrder:b.value,filter:p.value,showCompleted:$.value,importantOnly:d.value,urgentOnly:S.value};window.localStorage.setItem(Me,JSON.stringify(t))};Te(()=>{E()}),se([U,b,p,$,d,S],V,{deep:!1});const z=Y(()=>a.sortBy??U.value),q=Y(()=>a.showCompleted??$.value),g=Y(()=>a.scheduleItems.filter(t=>!(p.value!=="all"&&t.category!==p.value||!q.value&&t.completed||d.value&&!t.isImportant||S.value&&!t.isUrgent))),f=Y(()=>j(g.value)),j=t=>{const l=[...t],v=b.value==="asc"?1:-1,C=G=>{const[T="00",L="00"]=(G.time||"00:00").split(":");return Number(T)*60+Number(L)};if(z.value==="time")l.sort((G,T)=>(C(G)-C(T))*v);else{const G=T=>T==="high"?3:T==="medium"?2:T==="low"?1:0;l.sort((T,L)=>{const ne=T.isImportant?1:0,le=L.isImportant?1:0;if(ne!==le)return(le-ne)*v;const ee=T.isUrgent?1:0,te=L.isUrgent?1:0;if(ee!==te)return(te-ee)*v;const re=G(String(L.priority))-G(String(T.priority));return re!==0?re*v:(C(T)-C(L))*v})}return l},F=Y(()=>{const t=new Map;f.value.forEach(v=>{const C=t.get(v.date)??[];C.push(v),t.set(v.date,C)});const l=Array.from(t.keys()).sort((v,C)=>be(v).getTime()-be(C).getTime());return b.value==="desc"&&z.value==="time"&&l.reverse(),l.map(v=>[v,t.get(v)??[]])}),N=t=>be(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}),W=I(null),H=I(""),u=t=>{W.value=t.id,H.value=t.title,requestAnimationFrame(()=>{const l=document.getElementById(`inline-input-${t.id}`);l?.focus(),l?.select()})},r=t=>{if(!W.value)return;const l=H.value.trim();l&&l!==t.title&&c("updateTitle",{id:t.id,title:l}),W.value=null,H.value=""},k=()=>{W.value=null,H.value=""},n=()=>{b.value=b.value==="asc"?"desc":"asc"};return(t,l)=>{const v=xe;return m(),y("div",{class:Q(["rounded-2xl bg-white p-2 shadow-lg",a.variant==="compact"?"rounded-none bg-transparent p-0 shadow-none":""])},[a.variant!=="compact"?(m(),y("div",Lt,[R(e("select",{"onUpdate:modelValue":l[0]||(l[0]=C=>U.value=C),class:"rounded-full border border-gray-200 px-3 py-1 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},[...l[8]||(l[8]=[e("option",{value:"time"},"æŒ‰æ—¶é—´æ’åº",-1),e("option",{value:"importance"},"æŒ‰é‡è¦æ€§æ’åº",-1)])],512),[[De,U.value]]),e("button",{type:"button",onClick:n,class:"inline-flex items-center gap-1 rounded-full border border-gray-200 px-3 py-1 text-sm text-gray-700 transition hover:border-blue-200 hover:text-blue-700"},[Z(w(b.value==="asc"?"é¡ºåº":"å€’åº")+" ",1),M(v,{name:b.value==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-narrow-wide",class:"h-4 w-4"},null,8,["name"])]),R(e("select",{"onUpdate:modelValue":l[1]||(l[1]=C=>p.value=C),class:"rounded-full border border-gray-200 px-3 py-1 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},[...l[9]||(l[9]=[Fe('<option value="all">æ‰€æœ‰ç±»åˆ«</option><option value="work">å·¥ä½œ</option><option value="personal">ä¸ªäºº</option><option value="meeting">ä¼šè®®</option><option value="reminder">æé†’</option><option value="uncategorized">æœªåˆ†ç±»</option>',6)])],512),[[De,p.value]]),e("label",Rt,[R(e("input",{"onUpdate:modelValue":l[2]||(l[2]=C=>$.value=C),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,$.value]]),l[10]||(l[10]=Z(" æ˜¾ç¤ºå·²å®Œæˆ ",-1))]),e("label",Wt,[R(e("input",{"onUpdate:modelValue":l[3]||(l[3]=C=>d.value=C),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,d.value]]),l[11]||(l[11]=Z(" åªçœ‹é‡è¦ ",-1))]),e("label",qt,[R(e("input",{"onUpdate:modelValue":l[4]||(l[4]=C=>S.value=C),type:"checkbox",class:"h-4 w-4 rounded"},null,512),[[pe,S.value]]),l[12]||(l[12]=Z(" åªçœ‹ç´§æ€¥ ",-1))])])):B("",!0),e("div",{class:Q(["rounded-2xl border border-gray-100 bg-white p-4 shadow-sm",a.variant==="compact"?"border-none bg-transparent p-0 shadow-none":""])},[F.value.length===0?(m(),y("div",Gt,[M(jt,{message:"æš‚æ— å®‰æ’",onCreate:l[5]||(l[5]=C=>c("create")),onOpenAi:l[6]||(l[6]=C=>c("openAi"))})])):(m(),y("div",Qt,[(m(!0),y(J,null,K(F.value,([C,G])=>(m(),y("div",{key:C,class:"space-y-2"},[e("div",Ht,[l[13]||(l[13]=e("span",{class:"h-2 w-2 rounded-full bg-blue-500"},null,-1)),e("span",null,w(N(C)),1)]),e("div",Yt,[(m(!0),y(J,null,K(G,T=>(m(),y("div",{key:T.id,class:"flex items-center gap-2 rounded-xl px-2 py-1 hover:bg-gray-50",onDblclick:L=>u(T)},[e("button",{class:Q(["flex h-4 w-4 items-center justify-center rounded-full border border-blue-400 text-blue-500 transition hover:bg-blue-50",T.completed?"bg-blue-500 text-white":""]),onClick:L=>c("toggleComplete",T.id),title:T.completed?"æ ‡è®°æœªå®Œæˆ":"æ ‡è®°å®Œæˆ"},[T.completed?(m(),ge(v,{key:0,name:"i-lucide-check",class:"h-3 w-3"})):B("",!0)],10,Kt),e("div",Zt,[e("div",Xt,[e("div",{class:Q(["text-sm transition-colors",[T.completed?"text-gray-400 line-through":"text-gray-900",W.value===T.id?"invisible":""]])},w(T.title),3),W.value===T.id?R((m(),y("input",{key:0,id:`inline-input-${T.id}`,"onUpdate:modelValue":l[7]||(l[7]=L=>H.value=L),class:"absolute top-0 left-0 h-8 w-full rounded border border-blue-300 bg-white px-2 text-sm leading-tight shadow-sm focus:border-blue-400 focus:ring-2 focus:ring-blue-100 focus:outline-none",onKeydown:[_e(de(L=>r(T),["stop","prevent"]),["enter"]),_e(de(k,["stop","prevent"]),["esc"])],onBlur:L=>r(T)},null,40,eo)),[[ie,H.value]]):B("",!0)]),e("div",to,w(T.time||"--:--")+" Â· "+w(D(Ft)[T.category]),1)]),e("div",oo,[T.isImportant?(m(),y("span",so," é‡ ")):B("",!0),T.isUrgent?(m(),y("span",no," æ€¥ ")):B("",!0),e("button",{onClick:L=>c("edit",T),class:"rounded-full p-1 text-blue-600 transition hover:bg-blue-50"},[M(v,{name:"i-lucide-edit",class:"h-4 w-4"})],8,lo),e("button",{onClick:L=>c("delete",T.id),class:"rounded-full p-1 text-red-600 transition hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-50",disabled:i.deletingId===T.id},[M(v,{name:"i-lucide-trash",class:"h-4 w-4"})],8,ro)])],40,Jt))),128))])]))),128))]))],2)],2)}}}),ao={class:"rounded-2xl bg-white p-6 shadow-lg"},io={class:"mb-6 flex flex-wrap items-center justify-between gap-3"},uo={class:"text-xl font-semibold text-gray-900"},co={class:"mt-2 flex items-center gap-2 text-xs text-gray-500"},go={class:"flex items-center gap-2"},mo={class:"flex rounded-full bg-gray-100 p-1 text-sm"},po=["onClick"],fo={key:0,class:"space-y-3"},vo={class:"grid grid-cols-7 gap-2 text-center text-xs font-semibold text-gray-500"},yo={class:"grid grid-cols-7 gap-2"},bo=["onClick"],xo={class:"flex items-center justify-between"},ho={class:"text-sm font-semibold"},wo={key:0,class:"rounded-full bg-blue-100 px-1 text-[10px] font-semibold text-blue-700"},Do={class:"mt-1 space-y-1"},$o=["onClick"],ko={key:1,class:"space-y-3"},Io={class:"relative rounded-xl border border-gray-100 bg-gray-50 p-3"},To={class:"grid grid-cols-7 gap-3"},Uo=["onClick"],So={class:"text-[13px] font-semibold"},Co={class:"text-lg leading-tight font-bold"},_o={class:"grid grid-cols-7 gap-3"},Ao={class:"flex-1 space-y-2"},No={key:0,class:"rounded-lg border border-dashed border-gray-200 px-2 py-4 text-center text-xs text-gray-400"},Eo={class:"flex items-center justify-between font-semibold"},Mo={class:"truncate"},Oo=["onClick"],zo={class:"mt-1 text-[11px] text-gray-700"},Vo={key:2,class:"space-y-4"},Fo={class:"flex items-center justify-between rounded-xl border border-gray-100 bg-gray-50 p-3"},Po={class:"flex w-full items-center gap-3"},Bo={class:"grid flex-1 grid-cols-7 gap-3"},jo=["onClick"],Lo={class:"text-[13px] font-semibold"},Ro={class:"text-lg leading-tight font-bold"},Wo=ue({__name:"calendar-view",props:{currentDate:{},selectedDate:{},scheduleItems:{},mode:{},loading:{type:Boolean},deletingId:{}},emits:["update:selectedDate","update:currentDate","change-mode","create","edit","open-ai","toggle-complete","toggle-important","toggle-urgent","delete","update-title"],setup(i,{emit:_}){const a=i,c=_,U=["å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­","å‘¨æ—¥"],b=Y(()=>z(a.currentDate)),p=Y(()=>q(a.selectedDate)),$=u=>[...u].sort((r,k)=>(r.time||"00:00").localeCompare(k.time||"00:00")),d=Y(()=>$(g(a.selectedDate))),S=Y(()=>{if(a.mode==="day")return a.selectedDate.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"});if(a.mode==="week"){const u=p.value,r=u[0],k=u[u.length-1];return!r||!k?"":`${r.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})} - ${k.toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"})}`}return`${a.currentDate.getFullYear()} å¹´ ${a.currentDate.getMonth()+1} æœˆ`}),E=[{key:"day",label:"æ—¥"},{key:"week",label:"å‘¨"},{key:"month",label:"æœˆ"}],V=u=>{const r=new Date(u),k=r.getDay(),n=k===0?-6:1-k;return r.setDate(r.getDate()+n),r.setHours(0,0,0,0),r},z=u=>{const r=u.getFullYear(),k=u.getMonth(),n=new Date(r,k,1),t=new Date(n),l=(n.getDay()+6)%7;t.setDate(t.getDate()-l);const v=[];for(let C=0;C<42;C++){const G=new Date(t);G.setDate(t.getDate()+C),v.push(G)}return v},q=u=>{const r=V(u);return Array.from({length:7},(k,n)=>{const t=new Date(r);return t.setDate(r.getDate()+n),t})},g=u=>{const r=oe(u);return a.scheduleItems.filter(k=>k.date===r)},f=u=>{c("update:selectedDate",u),c("update:currentDate",u)},j=u=>{const r=new Date(a.selectedDate);a.mode==="day"?r.setDate(r.getDate()+u):a.mode==="week"?r.setDate(r.getDate()+u*7):(r.setMonth(r.getMonth()+u),r.setDate(1)),f(r)},F=()=>{f(new Date)},N=()=>{const u=new Date(a.selectedDate);u.setDate(u.getDate()-7),f(u)},W=()=>{const u=new Date(a.selectedDate);u.setDate(u.getDate()+7),f(u)},H=u=>u.toDateString()===new Date().toDateString();return(u,r)=>{const k=xe;return m(),y("div",ao,[e("div",io,[e("div",null,[e("h3",uo,w(S.value),1),e("div",co,[e("button",{onClick:r[0]||(r[0]=n=>j(-1)),class:"rounded-full border border-gray-200 px-3 py-1 transition hover:bg-gray-50"}," ä¸Šä¸€"+w(i.mode==="month"?"æœˆ":i.mode==="week"?"å‘¨":"å¤©"),1),e("button",{onClick:F,class:"rounded-full bg-blue-600 px-3 py-1.5 text-white shadow hover:bg-blue-700"}," ä»Šå¤© "),e("button",{onClick:r[1]||(r[1]=n=>j(1)),class:"rounded-full border border-gray-200 px-3 py-1 transition hover:bg-gray-50"}," ä¸‹ä¸€"+w(i.mode==="month"?"æœˆ":i.mode==="week"?"å‘¨":"å¤©"),1)])]),e("div",go,[e("div",mo,[(m(),y(J,null,K(E,n=>e("button",{key:n.key,onClick:t=>c("change-mode",n.key),class:Q(["rounded-full px-4 py-1.5 transition",i.mode===n.key?"bg-white text-gray-900 shadow":"text-gray-600 hover:text-gray-900"])},w(n.label),11,po)),64))])])]),i.mode==="month"?(m(),y("div",fo,[e("div",vo,[(m(),y(J,null,K(U,n=>e("div",{key:n},w(n),1)),64))]),e("div",yo,[(m(!0),y(J,null,K(b.value,(n,t)=>(m(),y("div",{key:t,onClick:l=>f(n),class:Q(["group relative h-24 cursor-pointer rounded-xl border border-transparent bg-gray-50 p-2 text-left transition hover:border-blue-100 hover:bg-white",[n.getMonth()===i.currentDate.getMonth()?"text-gray-900":"text-gray-400",H(n)?"border-blue-200 bg-blue-50":"",n.toDateString()===i.selectedDate.toDateString()?"ring-2 ring-blue-500":""]])},[e("div",xo,[e("span",ho,w(n.getDate()),1),g(n).length>1?(m(),y("span",wo," +"+w(g(n).length-1),1)):B("",!0)]),e("div",Do,[(m(!0),y(J,null,K(g(n).slice(0,2),l=>(m(),y("div",{key:l.id,class:Q(["w-full truncate rounded-md px-1 py-0.5 text-[10px]",l.completed?"bg-gray-200 text-gray-600 line-through":"bg-blue-100 text-blue-800"])},w(l.title),3))),128))]),n.toDateString()===i.selectedDate.toDateString()?(m(),y("button",{key:0,onClick:de(l=>c("create",n),["stop"]),title:"æ·»åŠ æ—¥ç¨‹",class:"absolute right-2 bottom-2 flex h-7 w-7 items-center justify-center rounded-full bg-blue-600 text-white opacity-0 shadow-lg transition group-hover:opacity-100"},[M(k,{name:"i-lucide-plus",class:"h-4 w-4"})],8,$o)):B("",!0)],10,bo))),128))])])):i.mode==="week"?(m(),y("div",ko,[e("div",Io,[e("div",To,[(m(!0),y(J,null,K(p.value,(n,t)=>(m(),y("button",{key:t,onClick:l=>f(n),class:Q(["flex flex-col items-center rounded-lg px-3 py-2 text-xs transition",[n.toDateString()===i.selectedDate.toDateString()?"bg-blue-600 text-white shadow":"text-gray-700 hover:bg-gray-100"]])},[e("span",So,w(U[t]),1),e("span",Co,w(n.getDate()),1)],10,Uo))),128))]),e("button",{onClick:N,class:"absolute top-1/2 -left-6 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-gray-200 text-gray-600 shadow-sm transition hover:bg-gray-50"},[M(k,{name:"i-lucide-chevron-left",class:"h-5 w-5"})]),e("button",{onClick:W,class:"absolute top-1/2 -right-6 flex h-9 w-9 -translate-y-1/2 items-center justify-center rounded-full border border-gray-200 text-gray-600 shadow-sm transition hover:bg-gray-50"},[M(k,{name:"i-lucide-chevron-right",class:"h-5 w-5"})])]),e("div",_o,[(m(!0),y(J,null,K(p.value,(n,t)=>(m(),y("div",{key:t,class:"flex min-h-[360px] flex-col rounded-xl border border-gray-100 bg-white/70 p-3 shadow-sm"},[e("div",Ao,[g(n).length===0?(m(),y("div",No," æš‚æ— å®‰æ’ ")):(m(!0),y(J,{key:1},K($(g(n)),l=>(m(),y("div",{key:l.id,class:"rounded-lg bg-amber-200/80 px-2 py-1 text-xs text-gray-800 shadow"},[e("div",Eo,[e("span",Mo,w(l.title),1),e("button",{class:"text-blue-700 hover:text-blue-900",onClick:v=>c("edit",l)},[M(k,{name:"i-lucide-edit",class:"h-4 w-4"})],8,Oo)]),e("div",zo,w(l.time),1)]))),128))])]))),128))])])):(m(),y("div",Vo,[e("div",Fo,[e("div",Po,[e("button",{onClick:N,class:"flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 transition hover:bg-gray-50"},[M(k,{name:"i-lucide-chevron-left",class:"h-5 w-5"})]),e("div",Bo,[(m(!0),y(J,null,K(p.value,(n,t)=>(m(),y("button",{key:t,onClick:l=>f(n),class:Q(["flex flex-col items-center rounded-lg px-3 py-2 text-xs transition",[n.toDateString()===i.selectedDate.toDateString()?"bg-blue-600 text-white shadow":"text-gray-700 hover:bg-gray-100"]])},[e("span",Lo,w(U[t]),1),e("span",Ro,w(n.getDate()),1)],10,jo))),128))]),e("button",{onClick:W,class:"flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-600 transition hover:bg-gray-50"},[M(k,{name:"i-lucide-chevron-right",class:"h-5 w-5"})])])]),M(Ue,{"selected-date":i.selectedDate,"schedule-items":d.value,"deleting-id":a.deletingId??null,onCreate:r[2]||(r[2]=n=>c("create",i.selectedDate)),onOpenAi:r[3]||(r[3]=n=>c("open-ai")),onToggleComplete:r[4]||(r[4]=n=>c("toggle-complete",n)),onToggleImportant:r[5]||(r[5]=n=>c("toggle-important",n)),onToggleUrgent:r[6]||(r[6]=n=>c("toggle-urgent",n)),onUpdateTitle:r[7]||(r[7]=n=>c("update-title",n)),onEdit:r[8]||(r[8]=n=>c("edit",n)),onDelete:r[9]||(r[9]=n=>c("delete",n))},null,8,["selected-date","schedule-items","deleting-id"])]))])}}}),qo={class:"flex min-h-0 flex-col rounded-2xl border border-gray-200 bg-white p-5 text-gray-900 shadow-sm",style:{"min-height":"calc(100vh - 220px)"}},Go={class:"mb-4 flex items-center justify-between gap-3"},Qo=["value"],Ho={class:"grid min-h-0 flex-1 auto-rows-fr grid-cols-1 divide-y divide-gray-200 md:grid-cols-2 md:divide-x md:divide-y-0"},Yo={class:"mb-3 flex items-center justify-between"},Jo={class:"flex items-center gap-2"},Ko={class:"group relative"},Zo={class:"invisible absolute top-full right-0 z-10 mt-1 w-28 rounded-lg border border-gray-200 bg-white p-2 text-[12px] text-gray-800 opacity-0 shadow-lg transition group-hover:visible group-hover:opacity-100"},Xo={class:"flex cursor-pointer items-center gap-2"},es={class:"mt-1 flex cursor-pointer items-center gap-2"},ts={class:"flex-1 overflow-auto pr-1 text-gray-900"},Oe="schedule:quadrant-sort",os=ue({__name:"quadrant-view",props:{selectedDate:{},scheduleItems:{},deletingId:{},dailyGoal:{}},emits:["update:dailyGoal","toggleComplete","toggleImportant","toggleUrgent","edit","delete","create","openAi","updateTitle"],setup(i,{emit:_}){const a=i,c=_,U=g=>g==="high",b=g=>g==="high"||g==="medium",p=Y(()=>({IU:a.scheduleItems.filter(g=>(g.isImportant??U(g.priority))&&(g.isUrgent??!1)),IN:a.scheduleItems.filter(g=>(g.isImportant??b(g.priority))&&!(g.isUrgent??!1)),NU:a.scheduleItems.filter(g=>!(g.isImportant??!1)&&(g.isUrgent??!1)),NN:a.scheduleItems.filter(g=>!(g.isImportant??!1)&&!(g.isUrgent??!1))})),$=I("time"),d=()=>{if(!(typeof window>"u"))try{const g=window.localStorage.getItem(Oe);if(!g)return;const f=JSON.parse(g);f.sortMode&&($.value=f.sortMode)}catch(g){console.warn("Failed to restore quadrant prefs",g)}},S=()=>{typeof window>"u"||window.localStorage.setItem(Oe,JSON.stringify({sortMode:$.value}))};Te(()=>{d()}),se($,S);const E=g=>{const[f="00",j="00"]=(g.time||"00:00").split(":");return Number(f)*60+Number(j)},V=g=>g.isImportant?3:g.priority==="high"?2:g.priority==="medium"?1:0,z=g=>{const f=[...g];return $.value==="time"?f.sort((j,F)=>E(j)-E(F)):f.sort((j,F)=>V(F)-V(j)),f},q=g=>z(p.value[g]);return(g,f)=>{const j=xe;return m(),y("div",qo,[e("div",Go,[f[12]||(f[12]=e("h3",{class:"text-lg font-semibold text-gray-900"},"å››è±¡é™è§†å›¾",-1)),e("input",{type:"text",value:i.dailyGoal,onInput:f[0]||(f[0]=F=>c("update:dailyGoal",F.target.value)),placeholder:"å½“æ—¥ç›®æ ‡...",class:"w-64 rounded-full border border-gray-200 px-3 py-1.5 text-xs placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-100"},null,40,Qo)]),e("div",Ho,[(m(),y(J,null,K([{key:"IU",title:"é‡è¦ä¸”ç´§æ€¥",color:"text-red-600"},{key:"IN",title:"é‡è¦ä¸ç´§æ€¥",color:"text-amber-600"},{key:"NU",title:"ä¸é‡è¦ä½†ç´§æ€¥",color:"text-emerald-600"},{key:"NN",title:"ä¸é‡è¦ä¸ç´§æ€¥",color:"text-gray-800"}],F=>e("div",{key:F.key,class:"flex h-full min-h-0 flex-col border border-gray-200 bg-white p-4 text-sm"},[e("div",Yo,[e("div",{class:Q(["font-semibold",F.color])},w(F.title)+" ("+w(p.value[F.key].length)+") ",3),e("div",Jo,[e("button",{onClick:f[1]||(f[1]=N=>c("create")),class:"flex h-7 w-7 items-center justify-center rounded-full border border-gray-200 text-gray-600 hover:bg-gray-100",title:"æ–°å»ºæ—¥ç¨‹"},[M(j,{name:"i-lucide-plus",class:"h-4 w-4"})]),e("div",Ko,[f[15]||(f[15]=e("button",{class:"rounded-full border border-gray-200 px-2 py-1 text-xs text-gray-600 hover:bg-gray-100",title:"æ’åº"}," ... ",-1)),e("div",Zo,[e("label",Xo,[R(e("input",{type:"radio",value:"time","onUpdate:modelValue":f[2]||(f[2]=N=>$.value=N),class:"h-3 w-3"},null,512),[[Ae,$.value]]),f[13]||(f[13]=Z(" æŒ‰æ—¶é—´ ",-1))]),e("label",es,[R(e("input",{type:"radio",value:"importance","onUpdate:modelValue":f[3]||(f[3]=N=>$.value=N),class:"h-3 w-3"},null,512),[[Ae,$.value]]),f[14]||(f[14]=Z(" æŒ‰é‡è¦ç¨‹åº¦ ",-1))])])])])]),e("div",ts,[M(Ue,{variant:"compact","selected-date":i.selectedDate,"schedule-items":q(F.key),"deleting-id":i.deletingId,"sort-by":$.value,"show-completed":!0,onToggleComplete:f[4]||(f[4]=N=>c("toggleComplete",N)),onToggleImportant:f[5]||(f[5]=N=>c("toggleImportant",N)),onToggleUrgent:f[6]||(f[6]=N=>c("toggleUrgent",N)),onUpdateTitle:f[7]||(f[7]=N=>c("updateTitle",N)),onEdit:f[8]||(f[8]=N=>c("edit",N)),onDelete:f[9]||(f[9]=N=>c("delete",N)),onCreate:f[10]||(f[10]=N=>c("create")),onOpenAi:f[11]||(f[11]=N=>c("openAi"))},null,8,["selected-date","schedule-items","deleting-id","sort-by"])])])),64))])])}}}),ss={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"},ns={class:"w-full max-w-lg rounded-xl bg-white p-6 shadow-2xl"},ls={class:"mb-4 flex items-center justify-between"},rs={class:"flex flex-col gap-1"},as={class:"text-xs tracking-widest text-gray-400 uppercase"},is={class:"text-xl font-semibold text-gray-900"},ds={class:"flex items-center gap-3"},us={class:"flex cursor-pointer items-center gap-1 rounded-full border border-gray-200 px-3 py-1 text-xs font-medium text-gray-600 transition hover:border-blue-200 hover:text-blue-600"},cs={class:"space-y-4"},gs={class:"rounded-xl border border-dashed border-gray-200 p-4"},ms={key:0,class:"mt-4 space-y-4 border-t border-gray-100 pt-4"},ps={class:"grid gap-4 md:grid-cols-2"},fs={class:"flex items-center gap-2"},vs={class:"grid gap-4 md:grid-cols-2"},ys={class:"grid gap-3 md:grid-cols-2"},bs={class:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm"},xs={class:"flex items-center gap-2 rounded-lg border border-gray-200 px-3 py-2 text-sm"},hs={key:0,class:"space-y-3"},ws={class:"flex justify-end gap-3"},Ds=["disabled"],$s=["disabled"],ks={key:1,class:"space-y-4"},Is={class:"rounded-xl border border-dashed border-blue-200 bg-blue-50/40 p-4"},Ts=["disabled"],Us=["disabled"],Ss={key:0,class:"rounded-lg bg-gray-50 px-3 py-2 text-sm text-gray-700"},Cs={key:1,class:"rounded-lg bg-amber-50 px-3 py-2 text-xs text-amber-800"},_s={key:2,class:"rounded-lg bg-red-50 px-3 py-2 text-sm text-red-700"},As={class:"flex justify-end"},Ns=ue({__name:"schedule-modal",props:{isOpen:{type:Boolean},editingItem:{},selectedDate:{},saving:{type:Boolean},startWithAi:{type:Boolean},modelId:{}},emits:["close","save"],setup(i,{emit:_}){const a=i,c=_,U=Y(()=>Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),b=n=>{if(!n)return"09:00";const t=n.match(/(\d{1,2}):(\d{2})/);if(!t||!t[1]||!t[2])return"09:00";const l=t[1].padStart(2,"0"),v=t[2].padStart(2,"0");return`${l}:${v}`},p=I({title:"",description:"",date:"",time:"09:00",priority:"none",category:"uncategorized",completed:!1,isImportant:!1,isUrgent:!1,meetingAgenda:"",attendees:""}),$=I(!1),d=I(!1),S=I(""),E=I(!1),V=I(null),z=I(null),q=I(null),g=I(null);se(()=>[a.editingItem,a.selectedDate],()=>{if(a.editingItem){const{title:n,description:t,date:l,time:v,priority:C,category:G,completed:T,isImportant:L,isUrgent:ne,meetingAgenda:le,attendees:ee}=a.editingItem;p.value={title:n,description:t,date:l||oe(a.selectedDate),time:b(v),priority:C,category:G,completed:T,isImportant:!!L,isUrgent:!!ne,meetingAgenda:le||"",attendees:ee||""}}else p.value={title:"",description:"",date:oe(a.selectedDate),time:"09:00",priority:"none",category:"uncategorized",completed:!1,isImportant:!1,isUrgent:!1,meetingAgenda:"",attendees:""}},{immediate:!0}),se(()=>a.isOpen,n=>{n&&(d.value=!!a.startWithAi)},{immediate:!0}),se(d,n=>{n||(S.value="",z.value=null,q.value=null,g.value=null,V.value=null)});const f=()=>{c("save",{...p.value,time:b(p.value.time)})},j=n=>{if(!n)return"09:00";const t=new Date(n);return Number.isNaN(t.getTime())?"09:00":`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`},F=n=>["work","personal","meeting","reminder","uncategorized"].includes(n)?n:"uncategorized",N=n=>["high","medium","low","none"].includes(n)?n:"none",W=n=>{const t=n.data.startTime?new Date(n.data.startTime):a.selectedDate,l=oe(t);return{title:n.data.title||n.summary||"",description:n.data.description||"",date:l,time:j(n.data.startTime)||"09:00",priority:N(n.data.priority),category:F(n.data.category),completed:n.data.completed??!1,isImportant:n.data.isImportant??!1,isUrgent:n.data.isUrgent??!1,meetingAgenda:"",attendees:n.data.attendees||""}},H=async()=>{const n=S.value.trim();if(!(!n||E.value)){E.value=!0,V.value=null,z.value=null,q.value=null,g.value=null;try{const t=await Pe({message:n,timezone:U.value,modelId:a.modelId});z.value=t.reply,q.value=t.followUpQuestion||null,t.proposal?g.value=t.proposal:t.requiresClarification||(V.value="AI æœªèƒ½ç”Ÿæˆå¾…åŠï¼Œè¯·æ¢ä¸€ç§æè¿°å†è¯•ä¸€æ¬¡ã€‚")}catch(t){console.error("AI parse schedule failed",t),V.value="AI å†™å¾…åŠæš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚"}finally{E.value=!1,S.value=""}}},u=()=>{if(!g.value)return;const n=W(g.value);c("save",n)},r=()=>{g.value=null},k=()=>{if(!g.value)return;const n=W(g.value);p.value=n,d.value=!1,$.value=!0};return(n,t)=>{const l=xe;return i.isOpen?(m(),y("div",ss,[e("div",ns,[e("div",ls,[e("div",rs,[e("p",as,w(i.editingItem?"ç¼–è¾‘æ—¥ç¨‹":"æ–°å»ºæ—¥ç¨‹"),1),e("h3",is,w(D(p).title||"è¾“å…¥æ ‡é¢˜"),1)]),e("div",ds,[e("label",us,[R(e("input",{type:"checkbox",class:"sr-only","onUpdate:modelValue":t[0]||(t[0]=v=>Ne(d)?d.value=v:null),"aria-label":"AIå†™å¾…åŠ"},null,512),[[pe,D(d)]]),M(l,{name:"i-lucide-bot",class:Q(["h-4 w-4",D(d)?"text-blue-600":"text-gray-400"])},null,8,["class"]),t[16]||(t[16]=e("span",null,"AIå†™å¾…åŠ",-1)),e("span",{class:Q(["relative inline-flex h-4 w-7 items-center rounded-full transition",D(d)?"bg-blue-600":"bg-gray-300"])},[e("span",{class:Q(["inline-block h-3 w-3 rounded-full bg-white transition",D(d)?"translate-x-3":"translate-x-0.5"])},null,2)],2)]),e("button",{class:"text-gray-400 transition hover:text-gray-600",type:"button",onClick:t[1]||(t[1]=v=>c("close"))},[M(l,{name:"i-lucide-x",class:"h-5 w-5"})])])]),D(d)?(m(),y("div",ks,[e("div",Is,[t[30]||(t[30]=e("p",{class:"text-sm font-medium text-blue-900"},"AI å†™å¾…åŠ",-1)),t[31]||(t[31]=e("p",{class:"text-xs text-blue-700"},"æè¿°ä½ æƒ³å®‰æ’çš„äº‹æƒ…ï¼ŒAI å°†å¸®ä½ ç”Ÿæˆå¾…åŠå¡ç‰‡ã€‚",-1)),e("form",{class:"mt-3 flex flex-col gap-3",onSubmit:de(H,["prevent"])},[R(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=v=>Ne(S)?S.value=v:null),rows:"3",class:"w-full rounded-lg border border-blue-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",placeholder:"ä¾‹å¦‚ï¼šæ˜å¤©ä¸Šåˆ10ç‚¹å’Œé”€å”®å›¢é˜Ÿå¼€ä¼šï¼Œæ€»ç»“å‘¨æŠ¥",disabled:D(E),required:""},null,8,Ts),[[ie,D(S)]]),e("button",{type:"submit",class:"inline-flex items-center justify-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:D(E)||!D(S).trim()},[M(l,{name:"i-lucide-bot",class:"mr-1 h-4 w-4"}),Z(" "+w(D(E)?"AI æ­£åœ¨ç”Ÿæˆ...":"AI å†™å¾…åŠ"),1)],8,Us)],32)]),D(z)?(m(),y("div",Ss,w(D(z)),1)):B("",!0),D(q)?(m(),y("div",Cs,w(D(q)),1)):B("",!0),D(V)?(m(),y("div",_s,w(D(V)),1)):B("",!0),D(g)?(m(),ge(Be,{key:3,proposal:D(g),onConfirm:u,onCancel:r,onEdit:k},null,8,["proposal"])):B("",!0),e("div",As,[e("button",{type:"button",class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",onClick:t[15]||(t[15]=v=>c("close"))}," å…³é—­ ")])])):(m(),y("form",{key:0,onSubmit:de(f,["prevent"]),class:"space-y-6"},[e("div",cs,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ ‡é¢˜",-1)),R(e("input",{"onUpdate:modelValue":t[2]||(t[2]=v=>D(p).title=v),type:"text",placeholder:"è¾“å…¥æ—¥ç¨‹æ ‡é¢˜",class:"w-full rounded-lg border border-gray-200 px-3 py-2 text-base focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,D(p).title]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-600"},"å¤‡æ³¨",-1)),R(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=v=>D(p).description=v),rows:"3",placeholder:"æ·»åŠ æè¿°æˆ–èƒŒæ™¯ä¿¡æ¯...",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,D(p).description]])])]),e("div",gs,[e("button",{type:"button",class:"flex w-full items-center justify-between text-sm font-medium text-gray-600",onClick:t[4]||(t[4]=v=>$.value=!D($))},[t[19]||(t[19]=e("span",null,"æ›´å¤šé€‰é¡¹",-1)),M(l,{name:"i-lucide-chevron-down",class:Q(["h-4 w-4 transition",D($)?"rotate-180":""])},null,8,["class"])]),D($)?(m(),y("div",ms,[e("div",ps,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ—¥æœŸ",-1)),R(e("input",{"onUpdate:modelValue":t[5]||(t[5]=v=>D(p).date=v),type:"date",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,D(p).date]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-600"},"æ—¶é—´",-1)),e("div",fs,[R(e("input",{"onUpdate:modelValue":t[6]||(t[6]=v=>D(p).time=v),type:"time",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200",required:""},null,512),[[ie,D(p).time]])])])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¸ä¼šäºº",-1)),R(e("input",{"onUpdate:modelValue":t[7]||(t[7]=v=>D(p).attendees=v),type:"text",placeholder:"æ·»åŠ ä¸ä¼šäºº...",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,D(p).attendees]])]),e("div",vs,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-600"},"ç±»åˆ«",-1)),R(e("select",{"onUpdate:modelValue":t[8]||(t[8]=v=>D(p).category=v),class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},[...t[23]||(t[23]=[Fe('<option value="uncategorized">æœªåˆ†ç±»</option><option value="work">å·¥ä½œ</option><option value="personal">ä¸ªäºº</option><option value="meeting">ä¼šè®®</option><option value="reminder">æé†’</option>',5)])],512),[[De,D(p).category]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¼˜å…ˆçº§",-1)),R(e("select",{"onUpdate:modelValue":t[9]||(t[9]=v=>D(p).priority=v),class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},[...t[25]||(t[25]=[e("option",{value:"none"},"æ— ",-1),e("option",{value:"low"},"ä½",-1),e("option",{value:"medium"},"ä¸­",-1),e("option",{value:"high"},"é«˜",-1)])],512),[[De,D(p).priority]])])]),e("div",ys,[e("label",bs,[R(e("input",{type:"checkbox",class:"rounded","onUpdate:modelValue":t[10]||(t[10]=v=>D(p).isImportant=v)},null,512),[[pe,D(p).isImportant]]),t[27]||(t[27]=e("span",null,"æ ‡è®°ä¸ºé‡è¦",-1))]),e("label",xs,[R(e("input",{type:"checkbox",class:"rounded","onUpdate:modelValue":t[11]||(t[11]=v=>D(p).isUrgent=v)},null,512),[[pe,D(p).isUrgent]]),t[28]||(t[28]=e("span",null,"æ ‡è®°ä¸ºç´§æ€¥",-1))])]),D(p).category==="meeting"?(m(),y("div",hs,[e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium text-gray-600"},"ä¼šè®®è®®ç¨‹",-1)),R(e("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=v=>D(p).meetingAgenda=v),placeholder:"ä¾‹å¦‚ï¼šé¡¹ç›®è¯„å®¡ã€æ–¹æ¡ˆç¡®è®¤",class:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:ring-2 focus:ring-blue-200"},null,512),[[ie,D(p).meetingAgenda]])])])):B("",!0)])):B("",!0)]),e("div",ws,[e("button",{type:"button",onClick:t[13]||(t[13]=v=>c("close")),class:"rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200",disabled:a.saving}," å–æ¶ˆ ",8,Ds),e("button",{type:"submit",class:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-semibold text-white shadow hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-70",disabled:a.saving},w(a.saving?"ä¿å­˜ä¸­...":i.editingItem?"æ›´æ–°æ—¥ç¨‹":"åˆ›å»ºæ—¥ç¨‹"),9,$s)])],32))])])):B("",!0)}}}),Es={class:"min-h-screen bg-gray-50 py-8"},Ms={class:"mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8"},Os={class:"mb-6 flex flex-wrap items-center justify-between gap-3"},zs={class:"flex flex-wrap items-center gap-2"},Vs={class:"flex rounded-full bg-white p-1 text-sm shadow-sm ring-1 ring-gray-200"},Fs=["onClick"],Ps={key:0,class:"mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700"},ze="schedule:page-state",Bs=3600*1e3,ke="__draft__",Qs=ue({__name:"index",setup(i){const _=I(new Date),a=I(new Date),c=I("calendar"),U=I("month"),b=I([]),p=I(!1),$=I(!1),d=I(null),S=I(!1),E=I({}),V=I(!1),z=I(null),q=I(!1),g=I(null),f=I(""),j=I(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"),F=[{key:"list",label:"æ¸…å•è§†å›¾"},{key:"calendar",label:"æ—¥å†è§†å›¾"},{key:"quadrant",label:"å››è±¡é™è§†å›¾"}];Te(async()=>{Ke();try{const o=await rt();o?.id&&(f.value=o.id)}catch(o){console.error("Failed to load default model",o)}});const N=[{id:"1",title:"å›¢é˜Ÿä¼šè®®",description:"è®¨è®ºQ4é¡¹ç›®è¿›å±•",date:ye(0,0),time:"09:00",priority:"high",category:"meeting",completed:!1,isImportant:!0,isUrgent:!0,meetingAgenda:"é¡¹ç›®è¿›å±•ã€é˜»å¡ç‚¹ã€ä¸‹å‘¨è®¡åˆ’",attendees:"äº§å“ã€ç ”å‘ã€æµ‹è¯•"},{id:"2",title:"AIé¡¹ç›®è¯„å®¡",description:"è¯„ä¼°æ–°AIåŠŸèƒ½çš„æŠ€æœ¯æ–¹æ¡ˆ",date:ye(0,0),time:"14:30",priority:"high",category:"work",completed:!1,isImportant:!0,isUrgent:!1},{id:"3",title:"å¥èº«è®­ç»ƒ",description:"è·‘æ­¥30åˆ†é’Ÿ + åŠ›é‡è®­ç»ƒ",date:ye(0,1),time:"07:00",priority:"medium",category:"personal",completed:!0,isImportant:!1,isUrgent:!1},{id:"4",title:"å®¢æˆ·ç”µè¯",description:"ä¸å¼ æ€»è®¨è®ºåˆä½œç»†èŠ‚",date:ye(0,1),time:"10:00",priority:"high",category:"work",completed:!1,isImportant:!0,isUrgent:!0},{id:"5",title:"è¯ç‰©æé†’",description:"è®°å¾—æœç”¨ç»´ç”Ÿç´ ",date:ye(0,2),time:"08:00",priority:"low",category:"reminder",completed:!1,isImportant:!1,isUrgent:!1}],W=o=>{if(!(!o||o==="uncategorized"))return o},H=o=>{if(!(!o||o==="none"))return o},u=(o,s)=>{const x=o||oe(new Date),h=s&&s.length>=4?s:"00:00",O=new Date(`${x}T${h}`);return Number.isNaN(O.getTime())?(console.warn("Invalid date/time detected, falling back to now",{date:x,time:h}),new Date):O},r=(o,s)=>{const h=(()=>{const fe=[s?.startDateTime,o.startDateTime];for(const ae of fe){if(!ae)continue;const ve=new Date(ae);if(!Number.isNaN(ve.getTime()))return ve}return u(o.date,o.time)})(),P=(()=>{const fe=[s?.endDateTime,o.endDateTime];for(const ae of fe){if(!ae)continue;const ve=new Date(ae);if(!Number.isNaN(ve.getTime()))return ve}if(o.endTime){const ae=new Date(`${o.date}T${o.endTime}`);if(!Number.isNaN(ae.getTime()))return ae}return new Date(h.getTime()+Bs)})(),A=[o.description,o.meetingAgenda].map(fe=>fe?.trim()).filter(Boolean).join(`
`),ce=o.attendees?.trim(),X={...s?.metadata??{},completed:o.completed};return{title:o.title,description:A||void 0,startTime:h.toISOString(),endTime:P.toISOString(),attendees:ce||void 0,category:W(o.category),priority:H(o.priority),isImportant:o.isImportant,isUrgent:o.isUrgent,timezone:s?.timezone||j.value,metadata:X}},k=o=>{const s=o.data,x=s.startTime?new Date(s.startTime):new Date;s.endTime&&new Date(s.endTime);const h=oe(x),O=globalThis.crypto?.randomUUID?.()!==void 0?globalThis.crypto.randomUUID():`${Date.now()}`;return{id:`${ke}${O}`,title:s.title||o.summary,description:s.description||o.summary,date:h,time:ee(s.startTime)||"09:00",endTime:ee(s.endTime),startDateTime:s.startTime,endDateTime:s.endTime,priority:s.priority||"none",category:s.category||"uncategorized",completed:s.completed??!1,isImportant:s.isImportant,isUrgent:s.isUrgent,meetingAgenda:s.description,attendees:s.attendees,timezone:s.timezone||j.value,metadata:s.metadata}},n=async o=>{V.value=!0,z.value=null;try{const{items:s}=await at({start:o.start.toISOString(),end:o.end.toISOString()}),x=s.map(A=>te(A)),h=new Map,O=o.start.getTime(),P=o.end.getTime();b.value.forEach(A=>{const X=be(A.date).getTime();(X<O||X>P)&&h.set(A.id,A)}),x.forEach(A=>h.set(A.id,A)),b.value=Array.from(h.values())}catch(s){const x=s instanceof Error?s:new Error(String(s));console.warn("Task API load failed, using mock data. Error:",x),z.value=x.message||"Failed to fetch tasks";const h=new Map;N.forEach(A=>h.set(A.id,A));const O=o.start.getTime(),P=o.end.getTime();b.value.forEach(A=>{const X=be(A.date).getTime();(X<O||X>P)&&h.set(A.id,A)}),b.value=Array.from(h.values())}finally{V.value=!1}},t=async o=>{if(!q.value){q.value=!0;try{const s=r(o,d.value),x=d.value?.id.startsWith(ke)??!1;let h;d.value&&!x?h=await Ee(d.value.id,s):h=await it(s),re(te(h)),p.value=!1,d.value=null,S.value=!1}catch(s){const x=s instanceof Error?s:new Error(String(s));console.error("Failed to save schedule",x),z.value=x.message||"ä¿å­˜æ—¥ç¨‹å¤±è´¥"}finally{q.value=!1}}},l=async o=>{g.value=o;try{await dt(o),b.value=b.value.filter(s=>s.id!==o),d.value&&d.value.id===o&&(d.value=null,p.value=!1,S.value=!1)}catch(s){const x=s instanceof Error?s:new Error(String(s));console.error("Failed to delete schedule",x),z.value=x.message||"åˆ é™¤æ—¥ç¨‹å¤±è´¥"}finally{g.value===o&&(g.value=null)}},v=o=>{const s=k(o);S.value=!1,d.value=s,p.value=!0,$.value=!1},C=o=>{const{id:s,...x}=o;return r(x,o)},G=async(o,s,x="æ›´æ–°æ—¥ç¨‹çŠ¶æ€å¤±è´¥")=>{const h={...o};if(Object.assign(o,s),!o.id.startsWith(ke))try{const O=C(o),P=await Ee(o.id,O);re(te(P)),z.value=null}catch(O){Object.assign(o,h);const P=O instanceof Error?O:new Error(String(O));console.error("Failed to update schedule",P),z.value=P.message||x}},T=o=>{const s=b.value.find(x=>x.id===o);s&&G(s,{completed:!s.completed})},L=o=>{const s=b.value.find(x=>x.id===o);s&&G(s,{isImportant:!s.isImportant})},ne=o=>{const s=b.value.find(x=>x.id===o);s&&G(s,{isUrgent:!s.isUrgent})},le=o=>{const s=b.value.find(x=>x.id===o.id);s&&G(s,{title:o.title},"æ›´æ–°æ—¥ç¨‹æ ‡é¢˜å¤±è´¥")},ee=o=>{if(!o)return"00:00";const s=new Date(o);return Number.isNaN(s.getTime())?o.slice(11,16)||o:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},te=o=>{const s=P=>{if(!P)return null;const A=new Date(P);return Number.isNaN(A.getTime())?null:A},x=s(o.startTime)??new Date,h=s(o.endTime),O=typeof o.completed=="boolean"?o.completed:!!o.metadata?.completed;return{id:o.id,title:o.title,description:o.description??"",date:oe(x),time:ee(o.startTime),endTime:ee(o.endTime??h?.toISOString()),startDateTime:s(o.startTime)?.toISOString(),endDateTime:h?.toISOString(),priority:o.priority,category:o.category,completed:O,isImportant:o.isImportant,isUrgent:o.isUrgent,meetingAgenda:o.description,attendees:o.attendees,timezone:o.timezone,metadata:o.metadata}},re=o=>{const s=b.value.findIndex(x=>x.id===o.id);s===-1?b.value.push(o):b.value[s]=o},je=o=>{const s=new Date(o),x=s.getDay(),h=x===0?-6:1-x;return s.setDate(s.getDate()+h),s.setHours(0,0,0,0),s},Le=o=>{const s=o.getFullYear(),x=o.getMonth(),h=new Date(s,x,1),O=new Date(h),P=(h.getDay()+6)%7;O.setDate(O.getDate()-P);const A=[];for(let ce=0;ce<42;ce++){const X=new Date(O);X.setDate(O.getDate()+ce),A.push(X)}return A},Re=Y(()=>Le(_.value)),We=Y(()=>{if(U.value==="day"){const P=new Date(a.value);P.setHours(0,0,0,0);const A=new Date(a.value);return A.setHours(23,59,59,999),{start:P,end:A}}if(U.value==="week"){const P=je(a.value),A=new Date(P);return A.setDate(P.getDate()+6),A.setHours(23,59,59,999),{start:P,end:A}}const o=Re.value;if(!o.length)return null;const s=o[0],x=o[o.length-1];if(!s||!x)return null;const h=new Date(s);h.setHours(0,0,0,0);const O=new Date(x);return O.setHours(23,59,59,999),{start:h,end:O}});se(We,o=>{o&&n(o)},{immediate:!0});const $e=o=>{S.value=!1,d.value=o,p.value=!0},Se=o=>{S.value=o,d.value=null,p.value=!0},he=()=>Se(!1),we=()=>Se(!0),Ce=o=>{a.value=o,_.value=new Date(o)},qe=o=>{_.value=o},Ge=o=>{E.value[oe(a.value)]=o},Qe=o=>{re(te(o))},He=o=>{re(te(o))},Ye=o=>{b.value=b.value.filter(s=>s.id!==o)},Je=o=>{o.forEach(s=>re(te(s)))},Ke=()=>{if(!(typeof window>"u"))try{const o=window.localStorage.getItem(ze);if(!o)return;const s=JSON.parse(o);if(s.activeView&&(c.value=s.activeView),s.calendarViewMode&&(U.value=s.calendarViewMode),s.selectedDate){const x=new Date(s.selectedDate);Number.isNaN(x.getTime())||(a.value=x,_.value=new Date(x))}if(s.currentDate){const x=new Date(s.currentDate);Number.isNaN(x.getTime())||(_.value=x)}s.dailyGoals&&(E.value=s.dailyGoals)}catch(o){console.warn("Failed to restore schedule page state",o)}};return se([c,U,a,_,E],()=>{if(typeof window>"u")return;const o={activeView:c.value,calendarViewMode:U.value,selectedDate:a.value.toISOString(),currentDate:_.value.toISOString(),dailyGoals:E.value};window.localStorage.setItem(ze,JSON.stringify(o))},{deep:!0}),(o,s)=>{const x=Vt;return m(),y("div",Es,[e("div",Ms,[e("div",Os,[s[11]||(s[11]=e("div",null,[e("h1",{class:"text-2xl font-semibold text-gray-900"},"æ—¥ç¨‹ç®¡ç†")],-1)),e("div",zs,[e("button",{onClick:s[0]||(s[0]=h=>he()),class:"rounded-full bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow-md transition hover:bg-blue-700"}," æ–°å»ºæ—¥ç¨‹ "),e("button",{onClick:s[1]||(s[1]=h=>we()),class:"rounded-full border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:border-blue-200 hover:text-blue-700"}," AI å†™å¾…åŠ "),e("div",Vs,[(m(),y(J,null,K(F,h=>e("button",{key:h.key,onClick:O=>c.value=h.key,class:Q(["rounded-full px-4 py-1.5 transition",c.value===h.key?"bg-blue-600 text-white shadow":"text-gray-600 hover:text-blue-700"])},w(h.label),11,Fs)),64))])])]),z.value?(m(),y("div",Ps," åŠ è½½æ—¥ç¨‹å¤±è´¥ï¼š"+w(z.value),1)):B("",!0),c.value==="list"?(m(),ge(Ue,{key:1,"selected-date":a.value,"schedule-items":b.value,"deleting-id":g.value,onToggleComplete:T,onToggleImportant:L,onToggleUrgent:ne,onUpdateTitle:le,onEdit:$e,onDelete:l,onCreate:s[2]||(s[2]=h=>he()),onOpenAi:s[3]||(s[3]=h=>we())},null,8,["selected-date","schedule-items","deleting-id"])):c.value==="calendar"?(m(),ge(Wo,{key:2,"current-date":_.value,"selected-date":a.value,"schedule-items":b.value,mode:U.value,loading:V.value,"deleting-id":g.value,"onUpdate:selectedDate":Ce,"onUpdate:currentDate":qe,onChangeMode:s[4]||(s[4]=h=>U.value=h),onCreate:s[5]||(s[5]=h=>{Ce(h),he()}),onEdit:$e,onOpenAi:s[6]||(s[6]=h=>we()),onToggleComplete:T,onToggleImportant:L,onToggleUrgent:ne,onDelete:l,onUpdateTitle:le},null,8,["current-date","selected-date","schedule-items","mode","loading","deleting-id"])):(m(),ge(os,{key:3,"selected-date":a.value,"schedule-items":b.value,"deleting-id":g.value,"daily-goal":E.value[D(oe)(a.value)]||"","onUpdate:dailyGoal":Ge,onToggleComplete:T,onToggleImportant:L,onToggleUrgent:ne,onUpdateTitle:le,onEdit:$e,onDelete:l,onCreate:s[7]||(s[7]=h=>he()),onOpenAi:s[8]||(s[8]=h=>we())},null,8,["selected-date","schedule-items","deleting-id","daily-goal"]))]),M(x,{open:$.value,"onUpdate:open":s[9]||(s[9]=h=>$.value=h),"model-id":f.value||void 0,timezone:j.value,onEventCreated:Qe,onEventUpdated:He,onEventDeleted:Ye,onQueryResult:Je,onEditProposal:v},null,8,["open","model-id","timezone"]),M(Ns,{isOpen:p.value,editingItem:d.value,selectedDate:a.value,saving:q.value,startWithAi:S.value,modelId:f.value||void 0,onClose:s[10]||(s[10]=h=>{p.value=!1,d.value=null,S.value=!1}),onSave:t},null,8,["isOpen","editingItem","selectedDate","saving","startWithAi","modelId"])])}}});export{Qs as default};
