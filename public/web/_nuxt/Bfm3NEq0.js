import{d as Y,b as ee,s as k,e as oe,g as I,w as H,i as te,j as B,o as f,p as e,A as Z,k as d,l as a,_ as ae,m as pe,n as Q,q as c,z as q,v as h,t as A,y as le,c as y,F as N,B as W,bs as fe,T as ve,G as _e,aJ as be,aq as ge,au as ye,f as he,aM as xe,aZ as we,a_ as ke,aK as X,x as G}from"#entry";import se from"./--UdezPG.js";import{_ as re}from"./BYwSSEjb.js";import{_ as Ve}from"./gWewHsLF.js";import{_ as Ue}from"./CBooyAK7.js";import{_ as Se}from"./B3ZBHMjU.js";import{_ as $e}from"./CFdZ4x-w.js";import{g as Ce}from"./ahy3UiMC.js";import{_ as Te}from"./CyGK14vg.js";import{_ as Ae}from"./ClwScvXM.js";import Ie from"./CfxLE1oh.js";import{_ as Be}from"./DNgvVYsj.js";import{_ as Me}from"./BYK_1AlN.js";import{e as Re,f as qe,g as Pe,h as De}from"./BcvHkqwA.js";import{c as Fe,d as Le,a as J}from"./BUyfW8JT.js";import{u as ze}from"./UqhBTNL6.js";import{u as Ke}from"./DqVgEjI6.js";import"./BgHJjJs-.js";import"./BaNg8fjw.js";import"./DlAUqK2U.js";import"./Dn8X9Gvz.js";import"./CqTMLIrD.js";import"./8-c-A7PB.js";import"./kRIii9yh.js";import"./Y5xxW4ru.js";import"./Cfcu-t3n.js";import"./C6Y-ieo6.js";import"./b-_TUx9i.js";import"./DaNf1Wdt.js";import"./CKXZhss7.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./B22A-h4k.js";import"./Bub1HYiY.js";import"./DN9ov8OT.js";import"./nBDBqKnC.js";import"./9bDOsXij.js";import"./aeYQPkOK.js";import"./Cv1u6XyE.js";import"./CKTa8Hyi.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./CP4Zo7YT.js";import"./XpsTG8vq.js";import"./DaWZu8wl.js";const Oe={class:"flex items-center gap-2"},je={class:"border-border bg-background w-[380px] rounded-lg border shadow-lg"},Ee={class:"p-3"},Ne={class:"grid h-full"},Ge={key:0,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},Je={class:"text-sm"},Ze={key:1,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},He={class:"text-sm font-medium"},Qe={class:"mt-1 text-xs"},We={key:2,class:"py-1"},Xe={key:0,class:"mb-1"},Ye=["onClick"],eo={class:"text-foreground flex-1 truncate font-medium"},oo={class:"text-muted-foreground flex items-center gap-1 text-xs"},to={key:0,class:"border-border/30 ml-4 border-l pl-3"},ao=["data-model-id","onClick"],lo={class:"flex-1 truncate font-medium"},so=Y({__name:"key-pool-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!0},console:{type:Boolean,default:!1},supportedModelTypes:{},buttonUi:{},showBillingRule:{type:Boolean,default:!1},openLocalStorage:{type:Boolean,default:!1}},emits:["update:modelValue","change"],setup(P,{emit:D}){const v=P,$=D,{t:x}=ee(),g=k(!1),p=k(!1),o=k(""),i=k(null),M=oe("scrollAreaRef"),w=k([]),V=k(new Set),C=I(()=>{const l=o.value.trim().toLowerCase();return l?w.value.map(t=>({...t,secretConfigs:(t.secretConfigs||t.Secrets||[]).filter(m=>m.name.toLowerCase().includes(l)||t.name.toLowerCase().includes(l))})).filter(t=>t.name.toLowerCase().includes(l)||((t.secretConfigs||t.Secrets)?.length||0)>0):w.value}),U=I(()=>{if(!i.value)return"";const l=w.value.find(t=>(t.secretConfigs||t.Secrets||[]).some(m=>m.id===i.value?.id));return l?`${l.name}/${i.value.name}`:i.value.name}),T=I(()=>w.value.flatMap(l=>l.secretConfigs||l.Secrets||[]));function n(l){i.value=l,$("update:modelValue",l?.id??""),$("change",l),p.value=!1,o.value=""}async function F(){if(!g.value){g.value=!0;try{w.value=await Ce(),V.value=new Set(w.value.map(t=>t.id));const l=t=>T.value.find(m=>m.id===t);if(!v.defaultSelected){i.value=l(v.modelValue)??null;return}i.value=(v.openLocalStorage?l(localStorage.getItem("modelId")??""):null)??l(v.modelValue)??null,i.value&&n(i.value)}catch(l){console.error("Failed to load key templates:",l)}finally{g.value=!1}}}async function L(){if(!i.value||!p.value||!M.value)return;await _e(),document.querySelector(`[data-model-id="${i.value.id}"]`)?.scrollIntoView({behavior:"smooth",block:"center"})}function z(l){const t=new Set(V.value);t.has(l)?t.delete(l):t.add(l),V.value=t}return H(p,l=>{l&&L()}),H(()=>v.modelValue,l=>{if(!g.value&&w.value.length){const t=T.value.find(m=>m.id===l);t&&(i.value=t)}}),te(()=>{F()}),(l,t)=>{const m=le,K=ae,O=se,j=re,_=fe,r=Ue,E=Se,S=$e;return f(),B(S,{open:e(p),"onUpdate:open":t[3]||(t[3]=s=>Z(p)?p.value=s:null),disabled:v.disabled},{content:d(()=>[c("div",je,[c("div",Ee,[a(j,{required:!1},{default:d(()=>[a(O,{modelValue:e(o),"onUpdate:modelValue":t[2]||(t[2]=s=>Z(o)?o.value=s:null),placeholder:e(x)("common.placeholder.searchKey"),size:"sm",class:"w-full",ui:{base:"bg-muted/30 border-border/50 focus:border-primary/50 focus:ring-primary/20"}},{leading:d(()=>[a(m,{name:"i-lucide-search",class:"text-muted-foreground h-4 w-4"})]),_:1},8,["modelValue","placeholder"])]),_:1})]),c("div",Ne,[a(E,{ref_key:"scrollAreaRef",ref:M,class:"max-h-[400px] min-h-[200px] px-2 pb-2",type:"hover",shadow:!1},{default:d(()=>[e(g)?(f(),y("div",Ge,[a(m,{name:"i-lucide-loader-2",class:"mb-2 h-6 w-6 animate-spin"}),c("span",Je,h(e(x)("common.loading")),1)])):A("",!0),e(C).length?(f(),y("div",We,[(f(!0),y(N,null,W(e(C),s=>(f(),y(N,{key:s.id},[((s.secretConfigs||s.Secrets)?.length||0)>0?(f(),y("div",Xe,[c("div",{class:"group hover:bg-muted/50 flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors",onClick:b=>z(s.id)},[a(_,{src:s.icon,alt:"icon",class:"h-4 w-4 flex-none"},null,8,["src"]),c("span",eo,h(s.name),1),c("div",oo,[c("span",null,"("+h((s.secretConfigs||s.Secrets)?.length||0)+")",1),a(r,{color:s.isEnabled===1?"success":"neutral",variant:"solid",size:"xs"},null,8,["color"])]),a(m,{name:e(V).has(s.id)?"i-lucide-chevron-down":"i-lucide-chevron-right",class:"text-muted-foreground h-3 w-3 transition-transform duration-150"},null,8,["name"])],8,Ye),a(ve,{"enter-active-class":"transition-all duration-150 ease-out","enter-from-class":"opacity-0 -translate-y-1","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-150 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-1"},{default:d(()=>[e(V).has(s.id)?(f(),y("div",to,[(f(!0),y(N,null,W(s.secretConfigs||s.Secrets||[],b=>(f(),y("div",{key:b.id,"data-model-id":b.id,class:q(["group/key hover:bg-muted/30 hover:text-foreground flex cursor-pointer items-center gap-2 rounded-md px-2 py-1.5 text-sm transition-colors",{"bg-primary/10 text-primary":e(i)?.id===b.id}]),onClick:R=>n(b)},[a(m,{name:"i-lucide-file-key-2",class:q(["h-4 w-4 flex-none",{"text-primary":e(i)?.id===b.id,"text-muted-foreground/70":e(i)?.id!==b.id}])},null,8,["class"]),c("span",lo,h(b.name),1),a(r,{color:b.status===1?"success":"neutral",variant:"solid",size:"xs"},null,8,["color"]),e(i)?.id===b.id?(f(),B(m,{key:0,name:"i-lucide-check",class:"text-primary h-3 w-3"})):A("",!0)],10,ao))),128))])):A("",!0)]),_:2},1024)])):A("",!0)],64))),128))])):(f(),y("div",Ze,[a(m,{name:"i-lucide-database",class:"mb-3 h-8 w-8 opacity-50"}),c("span",He,h(e(o)?e(x)("common.noSearchResults"):e(x)("common.empty")),1),c("span",Qe,h(e(o)?e(x)("common.tryOtherKeywords"):e(x)("common.noAvailableKeyPool")),1)]))]),_:1},512)])])]),default:d(()=>[a(K,pe({color:e(i)?"primary":"neutral",variant:"ghost",class:["flex w-full items-center justify-between",{"bg-primary/10":e(i)?.id}],loading:e(g),disabled:v.disabled},v.buttonUi,{onClick:t[1]||(t[1]=Q(()=>{},["stop"]))}),{default:d(()=>[c("span",{class:q(["truncate",{"text-muted-foreground":!e(U)}])},h(e(U)||e(x)("common.placeholder.keySelect")),3),c("div",Oe,[e(i)&&v.console?(f(),B(m,{key:0,name:"i-lucide-x",class:"h-4 w-4",onClick:t[0]||(t[0]=Q(s=>n(null),["stop"]))})):A("",!0),a(m,{name:"i-lucide-chevron-down",class:q(["h-4 w-4",{"rotate-180":e(p)}])},null,8,["class"])])]),_:1},16,["color","class","loading","disabled"])]),_:1},8,["open","disabled"])}}}),ro={key:0,class:"flex items-center justify-center",style:{height:"400px"}},no={class:"pb-2"},io={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},co={class:"space-y-4"},uo={class:"grid grid-cols-1 gap-4 pb-2 md:grid-cols-2"},mo={class:"space-y-4"},po={class:"flex h-8 items-center"},fo={class:"pb-2"},vo={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},dt=Y({__name:"edit",props:{id:{}},emits:["close"],async setup(P,{emit:D}){let v,$;const x=P,g=D,p=I(()=>x.id||M.query.id||null),{t:o}=ee(),i=ge(),M=be(),w=ye(),V=k([]),C=k([]),U=he(null),T=oe("formRef"),n=xe({provider:"",name:"",bindSecretId:"",websiteUrl:"",iconUrl:"",description:"",isActive:!0,sortOrder:0,supportedModelTypes:[]}),F=Fe({provider:J().required(o("ai-provider.backend.form.providerRequired")),name:J().required(o("ai-provider.backend.form.nameRequired")),bindSecretId:J().required(o("ai-provider.backend.form.apiKeyRequired")),supportedModelTypes:Le().min(1,o("ai-provider.backend.form.supportedModelTypesRequired"))}),{data:L}=([v,$]=we(()=>ke("model-types",()=>Re())),v=await v,$(),v);C.value=L.value||[];const{lockFn:z,isLock:l}=X(async()=>{try{const _=await qe(p.value);U.value=_,V.value=_.supportedModelTypes,ze(n,_)}catch(_){console.error("获取供应商详情失败:",_)}}),t=I({get:()=>String(n.isActive),set:_=>{n.isActive=_==="true"}});function m(){w.push({path:Ke("secret:list")}),g("close")}function K(){T.value?.validate?.()}const{lockFn:O,isLock:j}=X(async()=>{try{p.value?(await Pe(p.value,n),i.success(o("console-common.messages.success"))):(await De(n),i.success(o("console-common.messages.success"))),g("close",!0)}catch(_){console.error("提交失败:",_)}});return te(async()=>p.value&&await z()),(_,r)=>{const E=le,S=se,s=re,b=Ve,R=ae,ne=so,ie=Te,de=Ae,ce=Ie,ue=Be,me=Me;return f(),B(me,{title:e(p)?e(o)("ai-provider.backend.editTitle"):e(o)("ai-provider.backend.addTitle"),description:e(p)?e(o)("ai-provider.backend.form.editDescription"):e(o)("ai-provider.backend.form.addDescription"),ui:{content:"max-w-2xl"},onClose:r[11]||(r[11]=u=>g("close"))},{default:d(()=>[e(l)?(f(),y("div",ro,[a(E,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(f(),B(ue,{key:1,ref_key:"formRef",ref:T,state:e(n),schema:e(F),onSubmit:e(O)},{default:d(()=>[c("div",no,[c("div",io,[a(s,{label:e(o)("ai-provider.backend.form.provider"),name:"provider",required:""},{default:d(()=>[a(S,{disabled:e(U)?.isBuiltIn,modelValue:e(n).provider,"onUpdate:modelValue":r[0]||(r[0]=u=>e(n).provider=u),placeholder:e(o)("ai-provider.backend.form.providerPlaceholder"),ui:{root:"w-full"}},null,8,["disabled","modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:e(o)("ai-provider.backend.form.name"),name:"name",required:""},{default:d(()=>[a(S,{modelValue:e(n).name,"onUpdate:modelValue":r[1]||(r[1]=u=>e(n).name=u),placeholder:e(o)("ai-provider.backend.form.namePlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:e(o)("ai-provider.backend.form.iconUrl"),name:"iconUrl"},{default:d(()=>[a(b,{modelValue:e(n).iconUrl,"onUpdate:modelValue":r[2]||(r[2]=u=>e(n).iconUrl=u),class:"h-24 w-24",text:e(o)("console-common.uploadIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1},null,8,["modelValue","text"])]),_:1},8,["label"]),c("div",co,[a(s,{label:e(o)("ai-provider.backend.form.websiteUrl"),name:"websiteUrl"},{default:d(()=>[a(S,{modelValue:e(n).websiteUrl,"onUpdate:modelValue":r[3]||(r[3]=u=>e(n).websiteUrl=u),placeholder:e(o)("ai-provider.backend.form.websiteUrlPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(s,{label:e(o)("ai-provider.backend.form.sortOrder"),name:"sortOrder"},{default:d(()=>[a(S,{modelValue:e(n).sortOrder,"onUpdate:modelValue":r[4]||(r[4]=u=>e(n).sortOrder=u),type:"number",placeholder:e(o)("ai-provider.backend.form.sortOrderPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])]),c("div",uo,[c("div",mo,[a(s,{label:"API 配置",name:"bindSecretId",required:""},{hint:d(()=>[a(R,{variant:"link",class:"cursor-pointer gap-0","trailing-icon":"i-lucide-arrow-right",ui:{trailingIcon:"size-4",base:"p-0"},onClick:r[5]||(r[5]=u=>m())},{default:d(()=>[G(h(e(o)("ai-provider.backend.form.goToApiKeyManage")),1)]),_:1})]),default:d(()=>[a(ne,{modelValue:e(n).bindSecretId,"onUpdate:modelValue":r[6]||(r[6]=u=>e(n).bindSecretId=u),"button-ui":{variant:"outline",color:"neutral",ui:{base:"w-full"},class:"bg-background"},onChange:K},null,8,["modelValue"])]),_:1})]),a(s,{label:e(o)("ai-provider.backend.form.isActive"),name:"isActive"},{default:d(()=>[c("div",po,[a(ie,{class:"my-2",modelValue:e(t),"onUpdate:modelValue":r[7]||(r[7]=u=>Z(t)?t.value=u:null),items:[{label:e(o)("ai-provider.backend.form.isActiveEnabled"),value:"true"},{label:e(o)("ai-provider.backend.form.isActiveDisabled"),value:"false"}],orientation:"horizontal",color:"primary"},null,8,["modelValue","items"])])]),_:1},8,["label"])]),a(s,{label:e(o)("ai-provider.backend.form.modelType"),name:"supportedModelTypes",required:""},{default:d(()=>[a(de,{disabled:e(U)?.isBuiltIn,modelValue:e(n).supportedModelTypes,"onUpdate:modelValue":r[8]||(r[8]=u=>e(n).supportedModelTypes=u),"open-on-click":"",multiple:"","value-key":"value",items:e(C),ui:{root:"w-full"}},null,8,["disabled","modelValue","items"])]),_:1},8,["label"]),c("div",fo,[a(s,{label:e(o)("ai-provider.backend.form.description"),name:"description"},{default:d(()=>[a(ce,{modelValue:e(n).description,"onUpdate:modelValue":r[9]||(r[9]=u=>e(n).description=u),placeholder:e(o)("ai-provider.backend.form.descriptionPlaceholder"),rows:3,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),c("div",vo,[a(R,{color:"neutral",variant:"soft",size:"lg",onClick:r[10]||(r[10]=u=>g("close"))},{default:d(()=>[G(h(e(o)("console-common.cancel")),1)]),_:1}),a(R,{color:"primary",size:"lg",type:"submit",loading:e(j)},{default:d(()=>[G(h(e(p)?e(o)("console-common.update"):e(o)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"]))]),_:1},8,["title","description"])}}});export{dt as default};
