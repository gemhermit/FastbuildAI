import{_ as de}from"./CHHb5WZe.js";import me from"./CfxLE1oh.js";import{d as H,e as J,s as V,aq as P,b as A,g as I,j as O,o as S,k as w,l as x,_ as Y,n as k,q as b,v as K,p as a,A as M,x as pe,f as fe,a6 as ge,bB as q,bt as ve,ap as he,cy as xe,aS as G,aK as be,w as ye,i as _e,G as we,c as Fe,t as Q,r as E,z as X,an as Ue}from"#entry";import{_ as Z}from"./CeJbzRjl.js";import Le from"./--UdezPG.js";import{_ as Te}from"./Bu7cOM_l.js";import{_ as ze}from"./CFdZ4x-w.js";import{u as Se}from"./C1DLXs69.js";import{j as ke}from"./B1XcE43x.js";import{_ as Re}from"./DlAUqK2U.js";const $e={class:"text-background text-xs whitespace-pre-line"},Ce={class:"p-3"},Oe={class:"flex items-center gap-2"},Ie=["accept","disabled"],je=H({__name:"prompt-file-upload",props:{disabled:{type:Boolean},maxSize:{},accept:{}},emits:["file-select","url-submit"],setup(t,{emit:m}){const r=m,p=t,h=Se(),T=J("fileInputRefs"),i=V(""),d=V(!1),c=P(),{t:g}=A(),y=I(()=>{if(!h.selectedModel)return".pdf,.doc,.docx,.txt,.md";const n=h.selectedModel.features||[],s=[],f=[".pdf",".docx",".txt",".md",".rtf",".csv",".xlsx",".xls",".pptx"];return s.push(...f),n.includes("vision")&&s.push(".jpg",".jpeg",".png",".gif",".webp",".bmp"),n.includes("audio")&&s.push(".mp3",".wav",".flac",".aac",".ogg",".m4a"),s.join(",")}),R=I(()=>{const s=p.maxSize||100,f=h.selectedModel?.features?.includes("vision")||!1,U=g("common.chat.messages.uploadAttachmentTextOnly"),L=g("common.chat.messages.fileUploadLimit",{count:10,size:s}),z=f?g("common.chat.messages.supportsImage"):"";return`${U}
${L}${z}`}),_=()=>{d.value=!1,T.value?.click()};function F(n){const s=n.target,f=s.files?.[0];f&&r("file-select",f),s.value=""}function e(n){try{const U=new URL(n).pathname.split(".").pop()?.toLowerCase()||"";return U?`.${U}`:""}catch{const s=n.split(".").pop()?.toLowerCase()||"";return s?`.${s}`:""}}function o(n){return n?y.value.split(",").map(f=>f.trim()).includes(n.toLowerCase()):!1}function u(){const n=i.value.trim();if(!n)return;try{new URL(n)}catch{c.error(g("common.message.invalidUrl"));return}const s=e(n);if(!o(s)){c.error(g("common.message.unsupportedFileType"));return}r("url-submit",n),i.value="",d.value=!1}return(n,s)=>{const f=Y,U=Z,L=Le,z=Te,j=ze;return S(),O(j,{open:a(d),"onUpdate:open":s[2]||(s[2]=$=>M(d)?d.value=$:null)},{content:w(()=>[b("div",Ce,[b("div",null,[x(L,{modelValue:a(i),"onUpdate:modelValue":s[1]||(s[1]=$=>M(i)?i.value=$:null),ui:{root:"w-full",trailing:"!pe-0 !pr-1"},placeholder:a(g)("common.chat.messages.inputUrlPlaceholder")},{trailing:w(()=>[x(f,{size:"xs",onClick:k(u,["stop"])},{default:w(()=>[pe(K(a(g)("common.confirm")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),x(z,{class:"my-2",ui:{container:"text-xs font-normal text-muted-foreground"},label:"OR"}),b("div",Oe,[x(f,{size:"sm",label:a(g)("common.upload"),ui:{base:"flex-1 justify-center"},icon:"i-lucide-cloud-upload",variant:"outline",disabled:t.disabled,onClick:_},null,8,["label","disabled"])]),b("input",{ref_key:"fileInputRefs",ref:T,type:"file",accept:t.accept||a(y),class:"hidden",disabled:t.disabled,onChange:F},null,40,Ie)])]),default:w(()=>[x(U,{"delay-duration":0,ui:{content:"w-xs h-auto"}},{content:w(()=>[b("div",$e,K(a(R)),1)]),default:w(()=>[x(f,{onClick:s[0]||(s[0]=k(()=>{},["stop"])),size:"lg",variant:"ghost",icon:"i-lucide-paperclip",class:"rounded-full font-bold",disabled:t.disabled},null,8,["disabled"])]),_:1})]),_:1},8,["open"])}}}),Ee=["jpg","jpeg","png","gif","bmp","webp","svg"],Ve=["mp4","webm","ogg","mov","avi","wmv","flv","mkv"],Ne=["mp3","wav","ogg","m4a","aac","flac","wma"],Be=t=>t.extension?t.extension.toLowerCase():(t.name||t.originalName||"").split(".").pop()?.toLowerCase()||"",D=(t,m,r)=>{const p=Be(t),h=t.type?.toLowerCase()||"";return m.includes(p)||h.startsWith(r)},Me=t=>D(t,Ee,"image/"),Pe=t=>D(t,Ve,"video/"),Ae=t=>D(t,Ne,"audio/"),W=t=>Me(t)?"image":Pe(t)?"video":Ae(t)?"audio":"file";function De(){const{t}=A(),m=P(),r=fe([]),p=I(()=>r.value.some(e=>e.status==="uploading")),h=()=>`${Date.now()}-${Math.random().toString(36).slice(2,11)}`,T=e=>r.value.find(o=>o.id===e),i=(e,o)=>{const u=T(e);u&&Object.assign(u,o)},d=e=>{e.startsWith("blob:")&&URL.revokeObjectURL(e)},c=async e=>{const o=h(),u=URL.createObjectURL(e);r.value.push({id:o,name:e.name,size:e.size,url:u,progress:0,status:"uploading",mediaType:W(e),file:e});try{const n=await q({file:e,description:`Prompt file: ${e.name}`},{onProgress:s=>i(o,{progress:s})});return d(u),i(o,{status:"success",progress:100,url:n.url,result:n}),m.success(t("common.message.uploadSuccess")),n}catch(n){return console.error("File upload failed:",n),i(o,{status:"error",error:n instanceof Error?n.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),null}},g=async e=>{try{new URL(e.trim())}catch{return m.error(t("common.message.invalidUrl")),!1}const o=`url-${h()}`,u=e.trim(),n=u.split("/").pop()||"Remote File";r.value.push({id:o,name:n,size:0,url:u,progress:0,status:"uploading",mediaType:"image"});try{const s=await ve({url:u,description:`Remote file: ${n}`});return i(o,{status:"success",progress:100,url:s.url,size:s.size,name:s.originalName,mediaType:W(s),result:s}),m.success(t("common.message.urlAdded")),!0}catch(s){return i(o,{status:"error",error:s instanceof Error?s.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),!1}},y=e=>{const o=r.value.findIndex(u=>u.id===e.id);o!==-1&&(d(r.value[o]?.url??""),r.value.splice(o,1))},R=()=>{r.value.forEach(e=>d(e.url)),r.value=[]},_=async e=>{if(!e.file)return m.error(t("common.message.fileNotFound")),null;Object.assign(e,{status:"uploading",progress:0,error:void 0});try{const o=await q({file:e.file,description:`Prompt file: ${e.file.name}`},{onProgress:u=>e.progress=u});return d(e.url),Object.assign(e,{status:"success",progress:100,url:o.url,result:o}),m.success(t("common.message.uploadSuccess")),o}catch(o){return console.error("File upload failed:",o),Object.assign(e,{status:"error",error:o instanceof Error?o.message:t("common.message.uploadFailed")}),m.error(t("common.message.uploadFailed")),null}},F=()=>r.value.filter(e=>e.status==="success"&&e.result).map(e=>{switch(e.mediaType){case"image":return{type:"image_url",image_url:{url:e.url}};case"video":return{type:"video_url",video_url:{url:e.url}};case"audio":{const o=e.name.split(".").pop()?.toLowerCase()||"mp3";return{type:"input_audio",input_audio:{data:e.url,format:o}}}default:return{type:"file_url",name:e.name,url:e.url}}});return{files:ge(r),isUploading:p,uploadFile:c,addUrl:g,removeFile:y,clearFiles:R,retryUpload:_,generateFilesList:F}}const Ke={class:"flex items-center gap-2"},qe={class:"flex items-end justify-between p-0 sm:p-2"},Ge={class:"flex items-center gap-2"},Qe={class:"flex items-center gap-2"},Xe=H({__name:"chats-prompt",props:{modelValue:{default:""},fileList:{default:()=>[]},placeholder:{default:""},isLoading:{type:Boolean,default:!1},rows:{default:1},needAuth:{type:Boolean,default:!1},attachmentSizeLimit:{default:10},showFileUpload:{type:Boolean,default:!0}},emits:["update:modelValue","update:fileList","submit","stop"],setup(t,{emit:m}){const r=m,p=t,h=J("uTextareaRefs"),T=I(()=>h.value?.textareaRef||null),i=G(p,"modelValue",r),d=G(p,"fileList",r),{t:c}=A(),g=he(),y=P(),{focused:R}=xe(T,{initialValue:!1}),_=V(""),F=V(""),e=I(()=>F.value!==""&&i.value.trim()===F.value.trim()),{files:o,isUploading:u,uploadFile:n,addUrl:s,removeFile:f,retryUpload:U,generateFilesList:L,clearFiles:z}=De();function j(){h.value?.textareaRef?.focus(),!g.isAgreed&&p.needAuth&&Ue("/login")}function $(l){l.isComposing||l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),p.isLoading?r("stop"):r("submit",i.value))}function ee(){if(p.isLoading)r("stop");else{if(!i.value.trim()&&o.value.length===0)return;r("submit",i.value),z(),d.value=[]}}async function te(l){await n(l)&&(d.value=L())}async function se(l){await s(l)&&(d.value=L())}function oe(l){"id"in l&&(f(l),d.value=L())}async function ae(l){"id"in l&&await U(l)&&(d.value=L())}const{lockFn:ne,isLock:C}=be(async()=>{if(!i.value.trim()){y.warning(c("common.chat.messages.enterQuestion"));return}if(!p.isLoading)try{_.value=i.value.trim();const l=localStorage.getItem("modelId")||void 0,v=await ke({modelId:l,text:_.value});v.optimizedText?(F.value=v.optimizedText,i.value=v.optimizedText,y.success(c("common.chat.messages.optimizeSuccess"))):y.warning(c("common.chat.messages.optimizeEmpty"))}catch(l){console.error("文案优化失败:",l);const v=l?.message||c("common.chat.messages.optimizeFailed");y.error(v)}});function ie(){_.value&&(i.value=_.value,F.value="",_.value="")}return ye(()=>p.fileList,l=>{l.length===0&&o.value.length>0&&z()}),_e(()=>we(()=>{g.isAgreed&&j()})),(l,v)=>{const le=de,re=me,N=Y,B=Z,ce=je;return S(),Fe("div",{class:X(["chat-action-bar w-full rounded-md border p-1.5 transition-[border-color_box-shadow] duration-200 sm:rounded-2xl",a(R)?"ring-primary/15 border-primary ring-3":"border-border"]),onClick:k(j,["stop"])},[b("div",Ke,[E(l.$slots,"panel-top",{},void 0,!0)]),a(o).length>0?(S(),O(le,{key:0,files:[...a(o)],"show-actions":!0,class:"p-1.5",onRemove:oe,onRetry:ae},null,8,["files"])):Q("",!0),x(re,{ref_key:"uTextareaRefs",ref:h,modelValue:a(i),"onUpdate:modelValue":v[0]||(v[0]=ue=>M(i)?i.value=ue:null),class:X(["custom-textarea-wrapper w-full",{"optimizing-text":a(C)}]),style:{"--ui-bg-elevated":"var(--color-background)"},variant:"ghost",rows:t.rows,maxrows:8,highlight:!1,autoresize:!0,ui:{base:"resize-none custom-textarea text-base min-h-[40px] focus:bg-transparent hover:bg-transparent"},placeholder:t.placeholder||a(c)("common.chat.messages.inputPlaceholder"),disabled:a(C),onKeydown:$},null,8,["modelValue","class","rows","placeholder","disabled"]),b("div",qe,[b("div",Ge,[E(l.$slots,"panel-left",{},()=>[v[1]||(v[1]=b("div",null,null,-1))],!0)]),E(l.$slots,"panel-right",{},()=>[b("div",Qe,[a(e)?(S(),O(B,{key:0,text:a(c)("common.chat.messages.revertText"),"delay-duration":0,arrow:!0},{default:w(()=>[x(N,{icon:"i-lucide-undo-2",class:"rounded-full font-bold",size:"lg",variant:"ghost",color:"primary",disabled:p.isLoading,onClick:k(ie,["stop"])},null,8,["disabled"])]),_:1},8,["text"])):(S(),O(B,{key:1,text:a(C)?a(c)("common.chat.messages.optimizing"):a(i)?.trim()?a(c)("common.chat.messages.optimizeText"):a(c)("common.chat.messages.enterQuestion"),"delay-duration":0,arrow:!0},{default:w(()=>[x(N,{icon:"i-lucide-sparkles",class:"rounded-full font-bold",size:"lg",variant:"ghost",color:"primary",disabled:a(C)||!a(i)?.trim()||p.isLoading,loading:a(C),onClick:k(a(ne),["stop"])},null,8,["disabled","loading","onClick"])]),_:1},8,["text"])),t.showFileUpload?(S(),O(ce,{key:2,disabled:a(u),maxSize:t.attachmentSizeLimit,onFileSelect:te,onUrlSubmit:se},null,8,["disabled","maxSize"])):Q("",!0),E(l.$slots,"panel-right-item",{},void 0,!0),x(B,{content:{align:"center",side:"top",sideOffset:8},text:t.isLoading?a(c)("common.chat.messages.stopGeneration"):a(i)?.length?a(c)("common.chat.messages.sendMessage"):a(c)("common.chat.messages.enterQuestion"),"delay-duration":0,arrow:!0,disabled:t.isLoading||!!a(i)?.length},{default:w(()=>[x(N,{icon:t.isLoading?"i-lucide-square":"i-lucide-arrow-up",class:"rounded-full font-bold",size:"lg",disabled:!t.isLoading&&!a(i)?.length,color:t.isLoading?"error":"primary",onClick:k(ee,["stop"])},null,8,["icon","disabled","color"])]),_:1},8,["text","disabled"])])],!0)])],2)}}}),We=Re(Xe,[["__scopeId","data-v-51541a24"]]),it=Object.freeze(Object.defineProperty({__proto__:null,default:We},Symbol.toStringTag,{value:"Module"}));export{We as _,Ae as a,it as c,W as g,Pe as i};
