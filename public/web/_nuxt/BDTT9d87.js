const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CPF3nDK3.js","./o_OcGsLB.js","./BYK_1AlN.js","./BJ_E6Ph7.js","./DSMB-qMT.js","./b-_TUx9i.js","./B22A-h4k.js","./Cfcu-t3n.js","./B128ot1i.js","./CoMGTw2w.js","./CP4Zo7YT.js","./XpsTG8vq.js"])))=>i.map(i=>d[i]);
import{d as G,b as H,aq as J,Q,s as h,a1 as X,g as p,aK as V,w as Y,j as Z,o as ee,k as d,q as a,l,y as se,v as m,p as e,bI as C,n as F,_ as oe,A as re,x as U,bJ as ae,bK as ne,R as te,U as ie}from"#entry";import de from"./--UdezPG.js";import{_ as le}from"./BYwSSEjb.js";import{_ as ce}from"./CbuHra-u.js";import{_ as ue}from"./BYK_1AlN.js";import{d as we}from"./CP4Zo7YT.js";import"./BgHJjJs-.js";import"./8-c-A7PB.js";import"./B22A-h4k.js";import"./Cpt2kRVT.js";import"./pUN2d83w.js";import"./9bDOsXij.js";import"./CBooyAK7.js";import"./BJ_E6Ph7.js";import"./DSMB-qMT.js";import"./b-_TUx9i.js";import"./Cfcu-t3n.js";import"./B128ot1i.js";import"./CoMGTw2w.js";import"./XpsTG8vq.js";const me={class:"space-y-4"},pe={class:"space-y-4 pt-4"},fe={class:"text-muted-foreground text-xs"},ge={class:"space-y-4 pt-4"},_e={class:"rounded-lg border border-orange-200 bg-orange-50 p-4 dark:border-orange-800 dark:bg-orange-950"},be={class:"flex items-start gap-3"},ve={class:"space-y-2"},he={class:"font-medium text-orange-800 dark:text-orange-200"},Pe={class:"text-sm text-orange-700 dark:text-orange-300"},ke={class:"ml-4 list-disc space-y-1 text-sm text-orange-600 dark:text-orange-400"},ye={class:"flex justify-end gap-2"},Ne=G({__name:"edit-password",props:{userid:{}},emits:["close"],setup($,{emit:M}){const q=te(()=>ie(()=>import("./CPF3nDK3.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),_=$,B=M,{t:s}=H(),c=J(),I=Q(),i=h("change"),n=X({newPassword:"",confirmPassword:""}),g=h(!1),w=h({new:!1,confirm:!1}),K=p(()=>[{value:"change",label:s("user.backend.password.changeTab"),icon:"i-lucide-edit",slot:"change"},{value:"reset",label:s("user.backend.password.resetTab"),icon:"i-lucide-refresh-cw",slot:"reset"}]),b=p(()=>{const o={};if(i.value==="change"){const r=n.newPassword.trim(),t=n.confirmPassword.trim();r&&r.length<6&&(o.newPassword=s("user.backend.password.validation.passwordMinLength")),t&&r&&(r.length<6||t!==r&&(o.confirmPassword=s("user.backend.password.validation.passwordMismatch")))}return o}),L=p(()=>Object.keys(b.value).length>0),T=p(()=>{if(i.value==="reset")return!1;const o=n.newPassword.trim(),r=n.confirmPassword.trim();return!o||!r});function P(){n.newPassword="",n.confirmPassword="",w.value={new:!1,confirm:!1}}function k(o){w.value[o]=!w.value[o]}const{lockFn:E,isLock:y}=V(async()=>{const o=n.newPassword.trim(),r=n.confirmPassword.trim();if(!o){c.warning(s("user.backend.password.validation.newPasswordRequired"));return}if(o.length<6){c.warning(s("user.backend.password.validation.passwordMinLength"));return}if(!r){c.warning(s("user.backend.password.validation.confirmPasswordRequired"));return}if(r!==o){c.warning(s("user.backend.password.validation.passwordMismatch"));return}try{await ae(_.userid||"",o),c.success(s("user.backend.password.messages.changeSuccess")),f()}catch(t){console.error("修改密码失败:",t),c.error(t instanceof Error?t.message:s("user.backend.password.messages.changeFailed"))}}),z=o=>{I.create(q).open({password:o})},D=async()=>{if(!_.userid){c.error(s("user.backend.password.validation.userIdRequired"));return}try{g.value=!0;const{password:o}=await ne(_.userid||"");z(o),f()}catch(o){console.error("重置密码失败:",o),c.error(o instanceof Error?o.message:s("user.backend.password.messages.resetFailed"))}finally{g.value=!1}},{lockFn:S}=V(D);function v(){i.value==="change"?E():S()}const f=()=>{P(),B("close")};Y(i,()=>{P()});const j=p(()=>{const o=y.value||g.value;return i.value==="change"&&(T.value||L.value)||o});we({escape:f});const A=p(()=>y.value||g.value);return(o,r)=>{const t=oe,x=de,R=le,N=se,O=ce,W=ue;return ee(),Z(W,{title:e(s)("user.backend.password.title"),ui:{content:"max-w-md overflow-y-auto h-fit"},"show-footer":!0,onClose:r[5]||(r[5]=u=>f())},{footer:d(()=>[a("div",ye,[l(t,{variant:"soft",color:"neutral",onClick:f},{default:d(()=>[U(m(e(s)("user.backend.password.cancel")),1)]),_:1}),l(t,{disabled:e(j),color:e(i)==="reset"?"warning":"primary",loading:e(A),onClick:v},{default:d(()=>[U(m(e(i)==="change"?e(s)("user.backend.password.changePassword"):e(s)("user.backend.password.confirmReset")),1)]),_:1},8,["disabled","color","loading"])])]),default:d(()=>[a("div",me,[l(O,{modelValue:e(i),"onUpdate:modelValue":r[4]||(r[4]=u=>re(i)?i.value=u:null),items:e(K),class:"w-full"},{change:d(()=>[a("div",pe,[l(R,{label:e(s)("user.backend.password.newPassword"),size:"lg",required:"",error:e(b).newPassword},{default:d(()=>[l(x,{modelValue:e(n).newPassword,"onUpdate:modelValue":r[1]||(r[1]=u=>e(n).newPassword=u),type:e(w).new?"text":"password",placeholder:e(s)("user.backend.password.newPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[l(t,{variant:"ghost",size:"xs",icon:e(w).new?"i-lucide-eye-off":"i-lucide-eye",onClick:r[0]||(r[0]=u=>k("new"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),l(R,{label:e(s)("user.backend.password.confirmPassword"),size:"lg",required:"",error:e(b).confirmPassword},{default:d(()=>[l(x,{modelValue:e(n).confirmPassword,"onUpdate:modelValue":r[3]||(r[3]=u=>e(n).confirmPassword=u),type:e(w).confirm?"text":"password",placeholder:e(s)("user.backend.password.confirmPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[l(t,{variant:"ghost",size:"xs",icon:e(w).confirm?"i-lucide-eye-off":"i-lucide-eye",onClick:r[2]||(r[2]=u=>k("confirm"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),a("div",fe,m(e(s)("user.backend.password.passwordHelp")),1)])]),reset:d(()=>[a("div",ge,[a("div",_e,[a("div",be,[l(N,{name:"i-lucide-alert-triangle",class:"mt-0.5 size-5 text-orange-600 dark:text-orange-400"}),a("div",ve,[a("h4",he,m(e(s)("user.backend.password.resetConfirmTitle")),1),a("p",Pe,m(e(s)("user.backend.password.resetConfirmDesc")),1),a("ul",ke,[a("li",null,m(e(s)("user.backend.password.resetWarning1")),1),a("li",null,m(e(s)("user.backend.password.resetWarning2")),1)])])])])])]),_:1},8,["modelValue","items"])])]),_:1},8,["title"])}}});export{Ne as default};
